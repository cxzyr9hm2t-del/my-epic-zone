<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>HAYES' EPIC ZONE ğŸŸâš¡</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka:wght@400;600;700&family=Silkscreen&display=swap');
:root{
--blue1:#0a1628;--blue2:#0d2137;--blue3:#1a3a5c;--blue4:#2196F3;--blue5:#6485F6;--blue6:#BBDEFB;
--gold:#FFD700;--fry:#F4A460;--green:#39FF14;--pink:#FF6EC7;--cyan:#00F0FF;--purple:#B388FF;--orange:#FF9100;
--red:#FF5252;--lime:#76FF03;--amber:#FFAB00;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--blue1);color:#fff;font-family:'Fredoka',sans-serif;overflow-x:hidden;min-height:100vh}

/* SCROLLBAR */
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-track{background:var(--blue2)}
::-webkit-scrollbar-thumb{background:var(--blue4);border-radius:4px}

/* NAV BAR */
.topnav{position:sticky;top:0;z-index:100;background:rgba(10,22,40,0.95);backdrop-filter:blur(12px);border-bottom:2px solid var(--blue4);display:flex;align-items:center;padding:8px 15px;gap:6px;flex-wrap:wrap}
.topnav::-webkit-scrollbar{height:0}
.nav-btn{background:var(--blue3);border:2px solid var(--blue4);border-radius:12px;padding:6px 14px;color:var(--blue5);font-family:'Fredoka',sans-serif;font-size:13px;cursor:pointer;transition:all 0.2s;white-space:nowrap}
.nav-btn:hover,.nav-btn.active{background:var(--blue4);color:#fff;transform:scale(1.05)}
.nav-logo{font-family:'Bangers';font-size:20px;background:linear-gradient(135deg,var(--blue4),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-right:8px}
.streak-pill{background:linear-gradient(135deg,var(--orange),var(--gold));color:#000;font-family:'Silkscreen';font-size:11px;padding:4px 10px;border-radius:10px;font-weight:700;margin-left:auto;cursor:pointer;animation:pulse 2s infinite}
.energy-pill{background:linear-gradient(135deg,var(--green),var(--cyan));color:#000;font-family:'Silkscreen';font-size:11px;padding:4px 10px;border-radius:10px;font-weight:700;margin-left:6px;cursor:pointer}

/* HEADER */
header{background:linear-gradient(135deg,var(--blue2),var(--blue3));padding:25px 20px;text-align:center;position:relative;overflow:hidden;border-bottom:4px solid var(--blue4)}
header::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(90deg,transparent,transparent 40px,rgba(33,150,243,0.05) 40px,rgba(33,150,243,0.05) 80px)}
.logo{font-family:'Bangers',cursive;font-size:clamp(32px,8vw,64px);background:linear-gradient(135deg,var(--blue4),var(--cyan),var(--blue5));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.subtitle{font-family:'Silkscreen',monospace;font-size:clamp(10px,2.5vw,16px);color:var(--blue5);margin-top:5px;letter-spacing:2px}
.fry-rain{position:absolute;font-size:24px;animation:fryFall linear infinite;opacity:0.6;pointer-events:none}
@keyframes fryFall{0%{transform:translateY(-30px) rotate(0deg)}100%{transform:translateY(100vh) rotate(360deg)}}

/* MOOD CHECK */
.mood-bar{display:flex;gap:10px;justify-content:center;margin-top:12px;flex-wrap:wrap}
.mood-btn{font-size:32px;cursor:pointer;transition:0.2s;background:none;border:3px solid transparent;border-radius:50%;width:50px;height:50px;display:flex;align-items:center;justify-content:center}
.mood-btn:hover{transform:scale(1.3);border-color:var(--cyan)}
.mood-btn.selected{border-color:var(--gold);background:rgba(255,215,0,0.15);transform:scale(1.2)}
.mood-msg{font-family:'Fredoka';font-size:16px;color:var(--cyan);margin-top:8px;min-height:24px;transition:0.3s}

/* DAD MESSAGE */
.dad-msg-box{position:absolute;top:15px;right:15px;background:rgba(10,22,40,0.85);border:2px solid var(--purple);border-radius:16px;padding:12px 18px;max-width:260px;font-size:14px;backdrop-filter:blur(8px)}

/* WELCOME */
.welcome-section{text-align:center;padding:40px 20px}
.welcome-emoji{font-size:80px;animation:bounce 2s infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
.welcome-title{font-family:'Bangers';font-size:clamp(28px,6vw,48px);color:var(--gold);text-shadow:0 0 20px rgba(255,215,0,0.3)}

/* PROFILE BANNER */
.profile-banner{background:linear-gradient(135deg,var(--blue2),var(--blue3));border:3px solid var(--blue4);border-radius:20px;padding:20px;margin:0 20px 30px;display:flex;align-items:center;gap:20px;flex-wrap:wrap;position:relative;overflow:hidden}
.profile-banner::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,transparent 30%,rgba(33,150,243,0.05) 50%,transparent 70%);animation:shimmer 3s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.avatar-circle{width:80px;height:80px;border-radius:50%;border:3px solid var(--cyan);display:flex;align-items:center;justify-content:center;font-size:40px;background:var(--blue2);cursor:pointer;transition:0.3s;flex-shrink:0}
.avatar-circle:hover{border-color:var(--gold);transform:scale(1.1)}
.profile-info{flex:1;min-width:200px}
.profile-name{font-family:'Bangers';font-size:24px;color:var(--cyan)}
.level-badge{background:var(--gold);color:#000;font-family:'Silkscreen';font-size:12px;padding:2px 10px;border-radius:8px;display:inline-block;margin-left:8px}
.stat-row{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap}
.stat-pill{background:var(--blue3);border:1px solid var(--blue4);border-radius:8px;padding:4px 12px;font-family:'Silkscreen';font-size:11px;color:var(--blue6);white-space:nowrap}
.xp-bar-wrap{width:100%;background:var(--blue3);border-radius:10px;height:20px;margin-top:10px;overflow:hidden;border:1px solid var(--blue4)}
.xp-bar{height:100%;background:linear-gradient(90deg,var(--cyan),var(--blue4));border-radius:10px;transition:width 0.5s;min-width:2px}
.xp-text{font-family:'Silkscreen';font-size:10px;color:var(--blue6);text-align:right;margin-top:2px}

/* ENERGY METER */
.energy-section{text-align:center;margin:0 20px 20px}
.energy-wrap{background:var(--blue3);border-radius:12px;height:24px;overflow:hidden;border:2px solid var(--green);position:relative;max-width:400px;margin:8px auto}
.energy-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--lime));border-radius:10px;transition:width 0.5s}
.energy-label{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Silkscreen';font-size:10px;color:#000;font-weight:700}

/* CARDS GRID */
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;padding:0 20px;margin-bottom:30px}
.game-card{background:linear-gradient(135deg,var(--blue2),var(--blue3));border:2px solid var(--blue4);border-radius:16px;padding:20px;text-align:center;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden}
.game-card:hover{transform:translateY(-5px);border-color:var(--cyan);box-shadow:0 8px 25px rgba(0,240,255,0.2)}
.game-card-emoji{font-size:48px;margin-bottom:8px}
.game-card-title{font-family:'Bangers';font-size:22px;color:var(--cyan);margin-bottom:6px}
.game-card-desc{font-size:13px;color:var(--blue6);line-height:1.4}
.card-badge{position:absolute;top:10px;right:10px;font-family:'Silkscreen';font-size:10px;padding:3px 8px;border-radius:6px;font-weight:700}
.badge-hot{background:var(--orange);color:#000}
.badge-new{background:var(--pink);color:#000}
.badge-fav{background:var(--gold);color:#000}
.badge-fun{background:var(--green);color:#000}

/* SECTION HEADERS */
.section-header{font-family:'Bangers';font-size:clamp(24px,5vw,38px);text-align:center;padding:30px 0 20px;color:var(--gold)}

/* TICKER */
.ticker-wrap{overflow:hidden;background:var(--blue4);padding:8px 0;white-space:nowrap}
.ticker{display:inline-block;animation:scroll 30s linear infinite;font-family:'Silkscreen';font-size:13px;color:#000;font-weight:700}
@keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* ACHIEVEMENT SYSTEM */
.ach-grid{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;padding:0 20px;margin-bottom:30px}
.ach-item{width:80px;text-align:center;transition:0.3s}
.ach-item.locked{opacity:0.4;filter:grayscale(1)}
.ach-icon{width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 4px;border:3px solid var(--blue4);background:var(--blue3)}
.ach-item:not(.locked) .ach-icon{border-color:var(--gold);background:linear-gradient(135deg,var(--blue3),var(--blue2));animation:glow 2s infinite alternate}
@keyframes glow{from{box-shadow:0 0 5px var(--gold)}to{box-shadow:0 0 15px var(--gold)}}
.ach-label{font-family:'Silkscreen';font-size:9px;color:var(--blue5);margin-top:4px}

/* PET COMPANION */
.pet-section{background:linear-gradient(135deg,var(--blue2),rgba(179,136,255,0.1));border:3px solid var(--purple);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.pet-display{font-size:64px;cursor:pointer;transition:0.2s;display:inline-block}
.pet-display:hover{transform:scale(1.15)}
.pet-display.happy{animation:petBounce 0.5s}
@keyframes petBounce{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
.pet-stats{display:flex;gap:10px;justify-content:center;margin:10px 0;flex-wrap:wrap}
.pet-stat{font-family:'Silkscreen';font-size:11px;background:var(--blue3);border:1px solid var(--purple);padding:4px 10px;border-radius:8px}
.pet-btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px}
.pet-btn{background:var(--blue3);border:2px solid var(--purple);border-radius:12px;padding:8px 16px;color:#fff;font-family:'Fredoka';cursor:pointer;transition:0.2s}
.pet-btn:hover{background:var(--purple);transform:scale(1.05)}
.pet-evolution{font-family:'Silkscreen';font-size:10px;color:var(--purple);margin-top:8px}

/* CALM ZONE */
.calm-section{background:linear-gradient(135deg,var(--blue2),var(--blue3));border:3px solid var(--blue4);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.breath-circle{width:120px;height:120px;border-radius:50%;border:3px solid var(--cyan);margin:20px auto;display:flex;align-items:center;justify-content:center;font-family:'Fredoka';color:var(--cyan);transition:all 4s ease-in-out;background:radial-gradient(circle,rgba(0,240,255,0.1),transparent)}
.breath-circle.expand{width:180px;height:180px}
.sound-btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:15px}
.sound-btn{background:var(--blue3);border:2px solid var(--blue4);border-radius:12px;padding:8px 14px;color:#fff;font-family:'Fredoka';font-size:13px;cursor:pointer;transition:0.2s}
.sound-btn:hover{background:var(--blue4);transform:scale(1.05)}
.sound-btn.active{border-color:var(--cyan);background:rgba(0,240,255,0.15)}

/* DAILY CHALLENGE */
.challenge-section{background:linear-gradient(135deg,var(--blue2),rgba(255,145,0,0.1));border:3px solid var(--orange);border-radius:20px;padding:20px;margin:0 20px 30px;text-align:center}
.challenge-bar{width:100%;background:var(--blue3);border-radius:10px;height:16px;overflow:hidden;margin:10px 0;border:1px solid var(--orange)}
.challenge-fill{height:100%;background:linear-gradient(90deg,var(--orange),var(--gold));border-radius:10px;transition:width 0.5s}

/* ROUTINE BUILDER */
.routine-section{background:linear-gradient(135deg,var(--blue2),rgba(118,255,3,0.05));border:3px solid var(--green);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.routine-list{max-width:500px;margin:15px auto;text-align:left}
.routine-item{display:flex;align-items:center;gap:12px;padding:10px 15px;margin:6px 0;background:var(--blue3);border:2px solid var(--blue4);border-radius:12px;cursor:pointer;transition:0.2s}
.routine-item:hover{border-color:var(--green)}
.routine-item.done{border-color:var(--green);background:rgba(57,255,20,0.1)}
.routine-item.done .routine-check{background:var(--green);color:#000}
.routine-check{width:30px;height:30px;border-radius:50%;border:2px solid var(--blue4);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;transition:0.2s}
.routine-text{font-size:14px;flex:1}
.routine-reward{font-family:'Silkscreen';font-size:10px;color:var(--gold)}

/* QUEST / ADVENTURE */
.quest-section{background:linear-gradient(135deg,rgba(255,82,82,0.1),var(--blue2));border:3px solid var(--red);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.quest-card{background:var(--blue3);border:2px solid var(--red);border-radius:16px;padding:20px;margin:10px auto;max-width:500px;text-align:left}
.quest-title{font-family:'Bangers';font-size:22px;color:var(--red);margin-bottom:8px}
.quest-desc{font-size:13px;color:var(--blue6);margin-bottom:12px}
.quest-progress{display:flex;gap:6px;flex-wrap:wrap}
.quest-step{width:30px;height:30px;border-radius:50%;border:2px solid var(--blue4);display:flex;align-items:center;justify-content:center;font-family:'Silkscreen';font-size:10px}
.quest-step.complete{background:var(--red);border-color:var(--red);color:#fff}
.quest-step.current{border-color:var(--gold);animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}

/* QUOTE */
.quote-section{border-left:4px solid var(--gold);margin:0 20px 30px;padding:15px 20px;font-style:italic;color:var(--blue6)}

/* GAME FRAME */
.game-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:200;justify-content:center;align-items:center}
.game-overlay.active{display:flex}
.game-container{width:95%;max-width:800px;max-height:90vh;background:var(--blue2);border:3px solid var(--blue4);border-radius:20px;overflow:hidden;position:relative}
.game-header{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:var(--blue3);border-bottom:2px solid var(--blue4)}
.game-title{font-family:'Bangers';font-size:20px;color:var(--cyan)}
.game-close{background:var(--red);border:none;color:#fff;width:32px;height:32px;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.game-body{padding:15px;min-height:300px;max-height:70vh;overflow-y:auto}

/* MINI GAME AREA */
.mini-game{background:var(--blue1);border:2px solid var(--blue4);border-radius:12px;overflow:hidden}
.mini-game canvas{display:block;width:100%;height:auto}

/* POWER-UP CARDS */
.power-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;padding:0 20px;margin-bottom:30px}
.power-card{background:linear-gradient(135deg,var(--blue2),var(--blue3));border:2px solid var(--cyan);border-radius:16px;padding:18px;text-align:center;cursor:pointer;transition:all 0.3s}
.power-card:hover{transform:translateY(-4px);box-shadow:0 6px 20px rgba(0,240,255,0.2)}
.power-emoji{font-size:42px;margin-bottom:6px}
.power-title{font-family:'Bangers';font-size:18px;color:var(--cyan);margin-bottom:4px}
.power-desc{font-size:12px;color:var(--blue6)}

/* FOOTER */
.footer{text-align:center;padding:30px;border-top:2px solid var(--blue4)}
.footer-text{font-family:'Silkscreen';font-size:12px;color:var(--blue5)}

/* STARS */
.star{position:fixed;width:2px;height:2px;background:#fff;border-radius:50%;pointer-events:none;animation:twinkle 3s infinite alternate}
@keyframes twinkle{0%{opacity:0.2}100%{opacity:1}}

/* FRY COUNTER */
.fry-counter{position:fixed;bottom:20px;left:20px;background:rgba(10,22,40,0.9);border:2px solid var(--orange);border-radius:12px;padding:8px 14px;font-family:'Silkscreen';font-size:13px;z-index:50;cursor:pointer;backdrop-filter:blur(8px)}

/* TOAST NOTIFICATIONS */
.toast{position:fixed;top:80px;right:20px;background:var(--blue3);border:2px solid var(--cyan);border-radius:12px;padding:12px 20px;z-index:300;animation:slideIn 0.3s,slideOut 0.3s 2.7s;font-family:'Fredoka';font-size:14px;max-width:300px;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
@keyframes slideIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(120%);opacity:0}}

/* CONFETTI */
.confetti-piece{position:fixed;width:10px;height:10px;z-index:999;pointer-events:none;animation:confettiFall 2s forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* POPUP / MODAL */
.popup-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:250;justify-content:center;align-items:center}
.popup-overlay.active{display:flex}
.popup-box{background:var(--blue2);border:3px solid var(--cyan);border-radius:20px;padding:30px;max-width:500px;width:90%;text-align:center;max-height:80vh;overflow-y:auto;animation:popIn 0.3s}
@keyframes popIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
.popup-close{background:var(--red);border:none;color:#fff;width:36px;height:36px;border-radius:50%;font-size:20px;cursor:pointer;position:absolute;top:10px;right:10px}

/* AVATAR PICKER */
.avatar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:15px 0}
.avatar-option{font-size:36px;cursor:pointer;padding:8px;border-radius:12px;border:2px solid transparent;transition:0.2s;text-align:center}
.avatar-option:hover{border-color:var(--cyan);background:rgba(0,240,255,0.1)}

/* UPGRADE SHOP */
.upgrade-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;padding:0 20px;margin-bottom:30px}
.upgrade-card{background:linear-gradient(135deg,var(--blue2),var(--blue3));border:2px solid var(--purple);border-radius:16px;padding:18px;text-align:center;transition:0.3s}
.upgrade-card:hover{border-color:var(--cyan)}
.upgrade-emoji{font-size:36px;margin-bottom:6px}
.upgrade-name{font-family:'Bangers';font-size:16px;color:var(--cyan);margin-bottom:4px}
.upgrade-desc{font-size:11px;color:var(--blue6);margin-bottom:8px}
.upgrade-bar{width:100%;background:var(--blue1);height:6px;border-radius:3px;overflow:hidden;margin-bottom:6px}
.upgrade-fill{height:100%;background:var(--purple);border-radius:3px}
.upgrade-cost{font-family:'Silkscreen';font-size:11px;color:var(--gold);margin-bottom:6px}
.upgrade-btn{background:var(--purple);border:none;color:#fff;padding:6px 16px;border-radius:8px;font-family:'Silkscreen';font-size:11px;cursor:pointer;transition:0.2s}
.upgrade-btn:hover{background:var(--cyan)}
.upgrade-btn:disabled{opacity:0.4;cursor:not-allowed}
.upgrade-level{font-family:'Silkscreen';font-size:10px;background:var(--purple);color:#fff;padding:2px 8px;border-radius:6px;position:absolute;top:8px;right:8px}

/* HYPER FOCUS REACTOR */
.focus-section{background:linear-gradient(135deg,rgba(0,240,255,0.08),var(--blue2));border:3px solid var(--cyan);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.focus-time{font-family:'Bangers';font-size:clamp(48px,10vw,72px);color:var(--cyan);text-shadow:0 0 20px rgba(0,240,255,0.4)}
.focus-bar{width:80%;max-width:400px;background:var(--blue3);border-radius:10px;height:12px;overflow:hidden;margin:10px auto;border:1px solid var(--cyan)}
.focus-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:10px;transition:width 1s linear}
.focus-btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
.focus-btn{background:var(--blue3);border:2px solid var(--cyan);border-radius:10px;padding:8px 16px;color:#fff;font-family:'Silkscreen';font-size:12px;cursor:pointer;transition:0.2s}
.focus-btn:hover{background:var(--cyan);color:#000}

/* FIDGET BAY */
.fidget-section{background:linear-gradient(135deg,rgba(255,102,199,0.08),var(--blue2));border:3px solid var(--pink);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.bubble-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;max-width:350px;margin:15px auto}
.bubble{width:50px;height:50px;border-radius:50%;background:radial-gradient(circle at 30% 30%,rgba(255,102,199,0.6),var(--pink));border:2px solid var(--pink);cursor:pointer;transition:0.15s;display:flex;align-items:center;justify-content:center;font-size:20px}
.bubble:hover{transform:scale(1.1)}
.bubble.popped{transform:scale(0.3);opacity:0.2;pointer-events:none}

/* DAD LOVE FEATURES */
.dad-section{background:linear-gradient(135deg,rgba(179,136,255,0.1),var(--blue2));border:3px solid var(--purple);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.dad-btn{background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;padding:12px 24px;border-radius:14px;font-family:'Fredoka';font-size:16px;cursor:pointer;transition:0.2s;font-weight:600}
.dad-btn:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(255,102,199,0.4)}
.awesome-wall{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:15px 0}
.awesome-tag{background:linear-gradient(135deg,var(--blue4),var(--cyan));color:#fff;padding:8px 16px;border-radius:20px;font-family:'Fredoka';font-size:14px;font-weight:600;cursor:default;transition:0.2s}
.awesome-tag:hover{transform:scale(1.05)}

/* WORD SCRAMBLE GAME */
.word-scramble{text-align:center;padding:20px}
.scramble-letters{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:15px 0}
.scramble-letter{width:44px;height:44px;background:var(--blue3);border:2px solid var(--cyan);border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Bangers';font-size:24px;color:var(--cyan);cursor:pointer;transition:0.2s}
.scramble-letter:hover{background:var(--cyan);color:#000}
.scramble-letter.used{opacity:0.3;pointer-events:none}
.scramble-answer{display:flex;gap:6px;justify-content:center;margin:10px 0}
.scramble-slot{width:40px;height:40px;background:var(--blue1);border:2px dashed var(--blue4);border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Bangers';font-size:22px;color:var(--gold)}

/* MATH BLASTER */
.math-game{text-align:center;padding:20px}
.math-problem{font-family:'Bangers';font-size:clamp(36px,8vw,56px);color:var(--cyan);margin:15px 0}
.math-options{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:300px;margin:0 auto}
.math-option{background:var(--blue3);border:2px solid var(--blue4);border-radius:12px;padding:15px;font-family:'Bangers';font-size:24px;color:#fff;cursor:pointer;transition:0.2s}
.math-option:hover{border-color:var(--cyan);background:rgba(0,240,255,0.1)}
.math-option.correct{background:rgba(57,255,20,0.3);border-color:var(--green)}
.math-option.wrong{background:rgba(255,82,82,0.3);border-color:var(--red)}

/* ROCKET LAUNCH GAME */
.rocket-game{text-align:center;position:relative}
.rocket-game canvas{background:linear-gradient(to bottom,#0a0a2e,#1a1a4e);border-radius:12px;display:block;margin:0 auto}

/* DINO DASH */
.dino-game{text-align:center;position:relative}
.dino-game canvas{background:linear-gradient(to bottom,var(--blue2),var(--blue1));border-radius:12px;display:block;margin:0 auto}

/* RESPONSIVE */
@media(max-width:768px){
.profile-banner{flex-direction:column;text-align:center}
.card-grid{grid-template-columns:1fr 1fr}
.power-grid{grid-template-columns:1fr 1fr}
.upgrade-grid{grid-template-columns:1fr 1fr}
.topnav{justify-content:center}
}
@media(max-width:480px){
.card-grid{grid-template-columns:1fr}
.power-grid{grid-template-columns:1fr}
.upgrade-grid{grid-template-columns:1fr}
.bubble-grid{grid-template-columns:repeat(4,1fr)}
}

/* PROTOCOL ZERO - fullscreen breathing */
#protocol-zero{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#0a0a2e,#1a1a4e);z-index:999;justify-content:center;align-items:center;flex-direction:column}
#protocol-zero.active{display:flex}

/* TASK REWARD SYSTEM */
.task-section{background:linear-gradient(135deg,rgba(255,171,0,0.08),var(--blue2));border:3px solid var(--amber);border-radius:20px;padding:25px;margin:0 20px 30px;text-align:center}
.task-list{max-width:500px;margin:15px auto;text-align:left}
.task-item{display:flex;align-items:center;gap:12px;padding:10px 15px;margin:6px 0;background:var(--blue3);border:2px solid var(--blue4);border-radius:12px;cursor:pointer;transition:0.2s}
.task-item:hover{border-color:var(--amber)}
.task-item.done{border-color:var(--green);background:rgba(57,255,20,0.08);opacity:0.7}
.task-check{width:28px;height:28px;border-radius:50%;border:2px solid var(--amber);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.task-item.done .task-check{background:var(--green);border-color:var(--green);color:#000}
.task-text{flex:1;font-size:14px}
.task-fries{font-family:'Silkscreen';font-size:10px;color:var(--gold)}

/* SOUND TOGGLE */
.sound-toggle{position:fixed;bottom:20px;right:70px;background:rgba(10,22,40,0.9);border:2px solid var(--blue4);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:50;font-size:18px}

/* SCROLL TO TOP */
.scroll-top{position:fixed;bottom:20px;right:20px;background:var(--blue4);border:none;color:#fff;width:40px;height:40px;border-radius:50%;font-size:20px;cursor:pointer;z-index:50;display:flex;align-items:center;justify-content:center;transition:0.2s}
.scroll-top:hover{background:var(--cyan)}
</style>
</head>
<body>

<!-- STARS BACKGROUND -->
<div id="stars"></div>

<!-- PROTOCOL ZERO -->
<div id="protocol-zero">
<div id="breath-fs-text" style="font-family:Bangers;font-size:48px;color:var(--cyan)">Breathe in...</div>
<div style="width:200px;height:200px;border-radius:50%;border:4px solid var(--cyan);margin-top:30px;animation:breathPulse 8s infinite;display:flex;align-items:center;justify-content:center">
<div style="font-size:60px">ğŸŒŠ</div>
</div>
<button onclick="stopProtocolZero()" style="margin-top:30px;background:var(--red);border:none;color:#fff;padding:12px 24px;border-radius:12px;font-family:Fredoka;font-size:16px;cursor:pointer">Exit Calm Mode</button>
</div>

<!-- NAV BAR -->
<nav class="topnav" id="topnav">
<span class="nav-logo">HÂ·EÂ·Z</span>
<button class="nav-btn active" onclick="scrollToSection('top')"><span>ğŸ </span> Home</button>
<button class="nav-btn" onclick="scrollToSection('games')"><span>ğŸ®</span> Games</button>
<button class="nav-btn" onclick="scrollToSection('quest-sec')"><span>âš”ï¸</span> Quests</button>
<button class="nav-btn" onclick="scrollToSection('chill')"><span>ğŸ§˜</span> Chill</button>
<button class="nav-btn" onclick="scrollToSection('power')"><span>âš¡</span> Power</button>
<button class="nav-btn" onclick="scrollToSection('pet')"><span>ğŸ¾</span> Pet</button>
<button class="nav-btn" onclick="scrollToSection('upgrades')"><span>ğŸ“±</span> Upgrades</button>
<button class="nav-btn" onclick="scrollToSection('achievements')"><span>ğŸ†</span> Badges</button>
<button class="nav-btn" onclick="scrollToSection('routine-sec')"><span>ğŸ“‹</span> Routine</button>
<span class="streak-pill" id="streak-pill" onclick="showToast('ğŸ”¥ Keep visiting daily!')">ğŸ”¥ <span id="streak-count">1</span> DAY STREAK</span>
<span class="energy-pill" id="energy-pill">âš¡ <span id="energy-count">100</span>%</span>
</nav>

<!-- HEADER -->
<header id="header">
<div class="fry-rain" style="left:5%;animation-duration:4s;font-size:20px">ğŸŸ</div>
<div class="fry-rain" style="left:15%;animation-duration:6s;animation-delay:1s;font-size:16px">ğŸ’™</div>
<div class="fry-rain" style="left:30%;animation-duration:5s;animation-delay:2s">âš¡</div>
<div class="fry-rain" style="left:55%;animation-duration:7s;animation-delay:0.5s;font-size:18px">ğŸŸ</div>
<div class="fry-rain" style="left:75%;animation-duration:4.5s;animation-delay:3s">ğŸ</div>
<div class="fry-rain" style="left:90%;animation-duration:5.5s;animation-delay:1.5s;font-size:22px">ğŸ®</div>
<h1 class="logo">HAYES' EPIC ZONE</h1>
<p class="subtitle">ğŸŸ YOUR LEGENDARY GAMING HUB ğŸ®</p>
<p style="font-family:Silkscreen;font-size:12px;color:var(--blue5);margin-top:4px">HOW ARE YOU FEELING TODAY, HAYES?</p>
<div class="mood-bar" id="mood-bar">
<button class="mood-btn" onclick="setMood('happy')">ğŸ˜„</button>
<button class="mood-btn" onclick="setMood('love')">ğŸ˜</button>
<button class="mood-btn" onclick="setMood('cool')">ğŸ˜</button>
<button class="mood-btn" onclick="setMood('silly')">ğŸ˜œ</button>
<button class="mood-btn" onclick="setMood('meh')">ğŸ˜•</button>
<button class="mood-btn" onclick="setMood('sad')">ğŸ˜¢</button>
<button class="mood-btn" onclick="setMood('angry')">ğŸ˜¤</button>
<button class="mood-btn" onclick="setMood('tired')">ğŸ˜´</button>
<button class="mood-btn" onclick="setMood('hyper')">ğŸ¤©</button>
</div>
<div class="mood-msg" id="mood-msg"></div>
<div class="dad-msg-box">ğŸ’™ <span id="dad-greeting">Good evening, Hayes! Dad loves you!</span></div>
</header>

<!-- PROFILE BANNER -->
<div class="profile-banner" id="profile-banner">
<div class="avatar-circle" id="avatar-display" onclick="openAvatarPicker()" title="Tap to change">ğŸ®</div>
<div class="profile-info">
<span class="profile-name">âš¡ HAYES <span class="level-badge" id="level-badge">LVL 1</span></span>
<div class="stat-row">
<span class="stat-pill">ğŸŸ <span id="stat-fries">0</span> FRIES</span>
<span class="stat-pill">ğŸ® <span id="stat-games">0</span> PLAYED</span>
<span class="stat-pill">ğŸ† <span id="stat-badges">0</span> BADGES</span>
<span class="stat-pill">â­ <span id="stat-stars">0</span> STARS</span>
<span class="stat-pill">ğŸ”¥ <span id="stat-quests">0</span> QUESTS</span>
</div>
<div class="xp-bar-wrap"><div class="xp-bar" id="xp-bar" style="width:0%"></div></div>
<div class="xp-text" id="xp-text">0 / 100 XP</div>
</div>
</div>

<!-- ENERGY METER -->
<div class="energy-section">
<div style="font-family:Silkscreen;font-size:12px;color:var(--green)">âš¡ ENERGY METER âš¡</div>
<div class="energy-wrap">
<div class="energy-fill" id="energy-fill" style="width:100%"></div>
<span class="energy-label" id="energy-label">100%</span>
</div>
<div style="font-size:11px;color:var(--blue5);margin-top:4px">Play games to use energy Â· Energy recharges over time Â· Chill Zone restores energy!</div>
</div>

<!-- WELCOME -->
<div class="welcome-section" id="top">
<div class="welcome-emoji">ğŸŸ</div>
<h2 class="welcome-title">WELCOME BACK, HAYES! âš¡</h2>
<p style="color:var(--blue6);max-width:600px;margin:10px auto;line-height:1.6">This is YOUR legendary zone â€” built with ğŸ’™ just for you! Play epic games, earn fries, level up, take care of your pet, complete quests, and become the ultimate champion! You are amazing! ğŸ†</p>
<div class="fry-counter" id="fry-counter" onclick="collectFry()">ğŸŸ <span id="fry-count">0</span> FRIES COLLECTED</div>
</div>

<!-- DAILY CHALLENGE -->
<div class="challenge-section" id="daily-challenge">
<h3 style="font-family:Bangers;font-size:24px;color:var(--orange)">ğŸ¯ DAILY CHALLENGE ğŸ¯</h3>
<p id="challenge-text" style="margin:8px 0;color:var(--blue6)">Play 2 different games!</p>
<div class="challenge-bar"><div class="challenge-fill" id="challenge-fill" style="width:0%"></div></div>
<button onclick="completeChallenge()" id="challenge-btn" style="background:var(--orange);border:none;color:#000;padding:8px 20px;border-radius:10px;font-family:Silkscreen;font-size:12px;cursor:pointer">COMPLETE âœ…</button>
</div>

<!-- TICKER -->
<div class="ticker-wrap" id="ticker">
<div class="ticker">
ğŸŸ LEARN SOMETHING NEW! ğŸŸ THE LONGEST FRENCH FRY EVER WAS 34 INCHES! âš¡ HAYES IS A LEGEND! NEVER FORGET THAT! ğŸ® THE FIRST VIDEO GAME WAS MADE IN 1958! ğŸŸ FRENCH FRIES WERE INVENTED IN BELGIUM! â­ YOU'RE A SUPERSTAR, HAYES! ğŸš€ THE MOON IS 238,855 MILES AWAY! ğŸŸ AMERICANS EAT 4.5 BILLION LBS OF FRIES PER YEAR! ğŸ® MARIO WAS FIRST CALLED JUMPMAN! âš¡ LIGHTNING IS 5X HOTTER THAN THE SUN'S SURFACE! &nbsp;&nbsp;&nbsp;&nbsp;
ğŸŸ LEARN SOMETHING NEW! ğŸŸ THE LONGEST FRENCH FRY EVER WAS 34 INCHES! âš¡ HAYES IS A LEGEND! NEVER FORGET THAT! ğŸ® THE FIRST VIDEO GAME WAS MADE IN 1958! ğŸŸ FRENCH FRIES WERE INVENTED IN BELGIUM! â­ YOU'RE A SUPERSTAR, HAYES! ğŸš€ THE MOON IS 238,855 MILES AWAY! ğŸŸ AMERICANS EAT 4.5 BILLION LBS OF FRIES PER YEAR! ğŸ® MARIO WAS FIRST CALLED JUMPMAN! âš¡ LIGHTNING IS 5X HOTTER THAN THE SUN'S SURFACE! &nbsp;&nbsp;&nbsp;&nbsp;
</div>
</div>

<!-- ACHIEVEMENTS -->
<div id="achievements">
<h2 class="section-header">ğŸ† BADGES & ACHIEVEMENTS ğŸ†</h2>
<div class="ach-grid" id="ach-wrap"></div>
</div>

<!-- GAME ZONE -->
<div id="games">
<h2 class="section-header">ğŸ® GAME ZONE ğŸ®</h2>
<div class="card-grid" id="game-grid"></div>
</div>

<!-- GAME OVERLAY -->
<div class="game-overlay" id="game-overlay">
<div class="game-container">
<div class="game-header">
<span class="game-title" id="game-overlay-title">Game</span>
<button class="game-close" onclick="closeGame()">âœ•</button>
</div>
<div class="game-body" id="game-body"></div>
</div>
</div>

<!-- QUEST SECTION -->
<div id="quest-sec">
<h2 class="section-header">âš”ï¸ EPIC QUESTS âš”ï¸</h2>
<div id="quest-container" style="padding:0 20px"></div>
</div>

<!-- ROUTINE BUILDER -->
<div id="routine-sec">
<div class="routine-section">
<h3 style="font-family:Bangers;font-size:28px;color:var(--green)">ğŸ“‹ HAYES' DAILY ROUTINE ğŸ“‹</h3>
<p style="color:var(--blue6);font-size:13px;margin:5px 0">Complete your routine to earn bonus fries!</p>
<div class="routine-list" id="routine-list"></div>
<div style="margin-top:12px">
<span id="routine-progress" style="font-family:Silkscreen;font-size:12px;color:var(--green)">0/0 Done</span>
</div>
</div>
</div>

<!-- PET SECTION -->
<div id="pet">
<h2 class="section-header">ğŸ¾ YOUR PET BUDDY ğŸ¾</h2>
<div class="pet-section">
<h3 style="font-family:Bangers;font-size:24px;color:var(--pink)">MEET YOUR PET!</h3>
<p style="color:var(--blue6);font-size:13px">Take care of your pet! Feed it fries, play with it, and watch it grow & evolve! ğŸ’™</p>
<div class="pet-display" id="pet-display" onclick="petPat()">ğŸ¶</div>
<div id="pet-msg" style="color:var(--pink);font-size:14px;min-height:20px;margin:5px 0"></div>
<div style="color:var(--cyan);font-size:13px;margin:5px 0"><span id="pet-name">Buddy</span></div>
<div class="pet-stats">
<span class="pet-stat">â¤ï¸ HAPPY: <span id="pet-happy">0</span>%</span>
<span class="pet-stat">ğŸŸ FED: <span id="pet-fed">0</span>%</span>
<span class="pet-stat">â­ LEVEL: <span id="pet-level">1</span></span>
<span class="pet-stat">ğŸŒŸ STAGE: <span id="pet-stage">Baby</span></span>
</div>
<div class="pet-btns">
<button class="pet-btn" onclick="petFeed()">ğŸŸ Feed (5 Fries)</button>
<button class="pet-btn" onclick="petPlay()">ğŸ® Play</button>
<button class="pet-btn" onclick="petTrick()">â­ Trick</button>
<button class="pet-btn" onclick="openPetPicker()">ğŸ“± Change Pet</button>
</div>
<div class="pet-evolution" id="pet-evolution">Feed & play to evolve your pet! Stage: Baby â†’ Kid â†’ Teen â†’ Champion â†’ Legend</div>
</div>
</div>

<!-- CHILL ZONE -->
<div id="chill">
<h2 class="section-header">ğŸ§˜ CHILL ZONE ğŸ§˜</h2>
<div class="calm-section">
<h3 style="font-family:Bangers;font-size:24px;color:var(--cyan)">ğŸŒ€ TAKE A BREATH, HAYES ğŸŒ€</h3>
<p style="color:var(--blue6);font-size:13px">Follow the circle â€” breathe in as it grows, breathe out as it shrinks</p>
<div class="breath-circle" id="breath-circle">Breathe in...</div>
<div class="sound-btns">
<button class="sound-btn" onclick="playRain()">ğŸŒ§ï¸ Rain</button>
<button class="sound-btn" onclick="playOcean()">ğŸŒŠ Waves</button>
<button class="sound-btn" onclick="playForest()">ğŸŒ² Forest</button>
<button class="sound-btn" onclick="playSpace()">ğŸš€ Space</button>
<button class="sound-btn" onclick="stopCalm()">ğŸ•ª Stop</button>
</div>
</div>
</div>

<!-- QUOTE -->
<div class="quote-section" id="daily-quote">
<p id="quote-text">"Hayes, you make the world better just by being in it!"</p>
<span style="color:var(--cyan);font-size:12px">â€” ğŸ’™ <span id="quote-source">Fact</span></span>
</div>

<!-- POWER-UPS -->
<div id="power">
<h2 class="section-header">âš¡ POWER-UPS âš¡</h2>
<div class="power-grid" id="power-grid"></div>
</div>

<!-- FOOTER -->
<div class="footer">
<p class="footer-text">ğŸŸ MADE WITH ğŸ’™ JUST FOR HAYES ğŸŸ</p>
<p class="footer-text">HAYES' EPIC ZONE V4.0 â€” YOUR LEGENDARY SPACE</p>
</div>

<!-- TRANSMISSION -->
<div style="margin:0 20px 30px;background:linear-gradient(135deg,rgba(0,240,255,0.08),var(--blue2));border:3px solid var(--cyan);border-radius:20px;padding:20px;text-align:center">
<p style="font-style:italic;color:var(--blue6)"><span id="transmission-text">It is okay to take a break. Even heroes rest! ğŸ¦¸</span></p>
<span style="font-family:Silkscreen;font-size:11px;color:var(--cyan);cursor:pointer" onclick="newAffirmation()">ğŸ“¡ INCOMING TRANSMISSION Â· TAP FOR NEW SIGNAL</span>
</div>

<!-- HYPER FOCUS REACTOR -->
<div class="focus-section" id="focus-sec">
<h3 style="font-family:Bangers;font-size:28px;color:var(--cyan)">â³ HYPER-FOCUS REACTOR â³</h3>
<p style="color:var(--blue6);font-size:13px">Start the reactor before homework or reading. Earn fries when it finishes!</p>
<div class="focus-time" id="focus-time">15:00</div>
<div class="focus-bar"><div class="focus-fill" id="focus-fill" style="width:100%"></div></div>
<div class="focus-btns">
<button class="focus-btn" onclick="toggleFocusTimer()">â–¶ï¸ START</button>
<button class="focus-btn" onclick="resetFocusTimer()">ğŸ”„ RESET</button>
<button class="focus-btn" onclick="setFocusTime(5)">5 MIN</button>
<button class="focus-btn" onclick="setFocusTime(10)">10 MIN</button>
<button class="focus-btn" onclick="setFocusTime(15)">15 MIN</button>
<button class="focus-btn" onclick="setFocusTime(25)">25 MIN</button>
</div>
</div>

<!-- FIDGET BAY -->
<div class="fidget-section" id="fidget-sec">
<h3 style="font-family:Bangers;font-size:28px;color:var(--pink)">ğŸ«§ FIDGET BAY ğŸ«§</h3>
<p style="color:var(--blue6);font-size:13px">Need to get energy out? Pop some bubbles! They reset so you can pop again!</p>
<div class="bubble-grid" id="bubble-grid"></div>
<p style="font-family:Silkscreen;font-size:11px;color:var(--pink);margin-top:8px">POPPED: <span id="pop-count">0</span> ğŸ«§</p>
</div>

<!-- TASK REWARD SYSTEM -->
<div class="task-section" id="task-sec">
<h3 style="font-family:Bangers;font-size:28px;color:var(--amber)">â­ TASK REWARDS â­</h3>
<p style="color:var(--blue6);font-size:13px">Complete real-life tasks to earn fries! (Ask Dad to verify!)</p>
<div class="task-list" id="task-list"></div>
<p id="task-progress" style="font-family:Silkscreen;font-size:12px;color:var(--amber);margin-top:10px">0/0 Tasks Done</p>
</div>

<!-- HEARTS -->
<div style="text-align:center;padding:20px">
<span style="font-size:32px;cursor:pointer" onclick="spawnHearts()">ğŸ’™</span>
<span style="font-size:32px;cursor:pointer" onclick="spawnHearts()">ğŸ’™</span>
<span style="font-size:32px;cursor:pointer" onclick="spawnHearts()">ğŸ’™</span>
</div>

<!-- DAD LOVE FEATURES -->
<div class="dad-section">
<h3 style="font-family:Bangers;font-size:24px;color:var(--pink)">ğŸ”’ Secret Message From Dad</h3>
<p style="color:var(--blue6);font-size:13px">Tap to reveal today's secret message!</p>
<div onclick="revealSecret()" style="border:2px dashed var(--cyan);border-radius:12px;padding:15px;margin:10px auto;max-width:400px;cursor:pointer" id="secret-box">ğŸ”“ TAP TO UNLOCK</div>
</div>

<div class="dad-section">
<h3 style="font-family:Bangers;font-size:24px;color:var(--pink)">ğŸ Daily Surprise Capsule</h3>
<p style="color:var(--blue6);font-size:13px">Open your daily surprise from Dad!</p>
<button class="dad-btn" onclick="openCapsule()">ğŸª OPEN CAPSULE</button>
</div>

<div class="dad-section">
<h3 style="font-family:Bangers;font-size:24px;color:var(--pink)">ğŸ’Œ Dad's Love Letter</h3>
<p style="color:var(--blue6);font-size:13px">A special letter just for you, Hayes!</p>
<button class="dad-btn" onclick="showLoveLetter()">ğŸ’“ Read Dad's Letter</button>
</div>

<div class="dad-section">
<h3 style="font-family:Bangers;font-size:24px;color:var(--cyan)">â­ Reasons Hayes Is AWESOME</h3>
<div class="awesome-wall" id="awesome-wall"></div>
</div>

<!-- UPGRADE SHOP -->
<div id="upgrades">
<h2 class="section-header">â¬†ï¸ UPGRADE SHOP â¬†ï¸</h2>
<div style="text-align:center;margin-bottom:10px">
<span style="font-family:Silkscreen;font-size:12px;color:var(--blue5)">ğŸ’° SPEND FRIES TO POWER UP!</span>
<p style="font-size:13px;color:var(--blue6)">Upgrade your zone, enhance your games, and unlock epic abilities!</p>
</div>
<div class="upgrade-grid" id="upgrade-grid"></div>
</div>

<!-- POPUP -->
<div class="popup-overlay" id="popup-overlay" onclick="closePopup()">
<div class="popup-box" onclick="event.stopPropagation()">
<div id="popup-content"></div>
<button onclick="closePopup()" style="margin-top:15px;background:var(--blue4);border:none;color:#fff;padding:8px 20px;border-radius:10px;font-family:Fredoka;cursor:pointer">Close</button>
</div>
</div>

<!-- SOUND TOGGLE & SCROLL TOP -->
<div class="scroll-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">âš“</div>

<script>
/* ====================== */
/*   HAYES' EPIC ZONE v4.0 */
/*   COMPLETE GAME ENGINE   */
/* ====================== */

// ---- DATA & STATE ----
const SAVE_KEY = 'epiczone_v4';
let gameData = {
  fries: 0, xp: 0, level: 1, gamesPlayed: 0, stars: 0, questsComplete: 0,
  streak: 1, lastVisit: '', mood: '', avatar: 'ğŸ®',
  pet: { type: 'ğŸ¶', name: 'Buddy', happy: 50, fed: 50, level: 1, xp: 0, tricks: 0 },
  achievements: {},
  challengeDone: false, challengeProgress: 0, challengeGames: [],
  energy: 100, maxEnergy: 100,
  upgrades: {},
  routineDone: {},
  tasksDone: {},
  questProgress: {},
  focusTotal: 0,
  totalPops: 0,
  clickBest: 0,
  gamesRecord: {}
};

function loadData() {
  try {
    const s = localStorage.getItem(SAVE_KEY);
    if (s) {
      const d = JSON.parse(s);
      Object.assign(gameData, d);
      // Migrate old saves
      if (!gameData.energy) gameData.energy = 100;
      if (!gameData.maxEnergy) gameData.maxEnergy = 100;
      if (!gameData.questProgress) gameData.questProgress = {};
      if (!gameData.questsComplete) gameData.questsComplete = 0;
      if (!gameData.pet.tricks) gameData.pet.tricks = 0;
    }
    // Also try to load from old save key
    const oldFries = localStorage.getItem('epiczone_fries');
    if (oldFries && !s) {
      gameData.fries = parseInt(oldFries) || 0;
    }
  } catch(e) {}
}
function saveData() {
  try { localStorage.setItem(SAVE_KEY, JSON.stringify(gameData)); } catch(e) {}
}

// ---- MOOD MESSAGES ----
const MOOD_MSGS = {
  happy: "You're feeling awesome! Let's have an EPIC time! ğŸŒŸ",
  love: "Spreading love everywhere! You're the BEST, Hayes! ğŸ’–",
  cool: "Looking cool, feeling cool! You're a legend! ğŸ˜",
  silly: "Silly mode activated! Time for maximum fun! ğŸ¤ª",
  meh: "That's okay! Let's find something fun to boost your mood! ğŸ’™",
  sad: "It's okay to feel sad. Dad loves you SO much. Want to visit the Chill Zone? ğŸ¤—",
  angry: "Take a deep breath, champion. You've got this! Try the breathing exercise! ğŸ’ª",
  tired: "Even superheroes need rest! Take it easy, Hayes ğŸ˜´",
  hyper: "MAXIMUM ENERGY MODE! Let's channel that into something EPIC! ğŸš€"
};

// ---- ACHIEVEMENTS ----
const ACHIEVEMENTS = [
  { id: 'first_visit', name: 'FIRST VISIT', emoji: 'ğŸŒŸ', desc: 'Welcome to your zone!' },
  { id: 'fry_fan', name: 'FRY FAN', emoji: 'ğŸŸ', desc: 'Collect 50 fries' },
  { id: 'fry_lord', name: 'FRY LORD', emoji: 'ğŸŸ', desc: 'Collect 500 fries' },
  { id: 'fry_king', name: 'FRY KING', emoji: 'ğŸ‘‘', desc: 'Collect 2000 fries' },
  { id: 'mood_check', name: 'MOOD CHECK', emoji: 'ğŸ˜Š', desc: 'Check your mood' },
  { id: 'gamer', name: 'GAMER', emoji: 'ğŸ®', desc: 'Play your first game' },
  { id: 'pro_gamer', name: 'PRO GAMER', emoji: 'ğŸ®', desc: 'Play 10 games' },
  { id: 'mega_gamer', name: 'MEGA GAMER', emoji: 'ğŸ•¹ï¸', desc: 'Play 50 games' },
  { id: 'pet_lover', name: 'PET LOVER', emoji: 'ğŸ’•', desc: 'Feed your pet 5 times' },
  { id: 'pet_master', name: 'PET MASTER', emoji: 'ğŸ‘‘', desc: 'Get pet to level 5' },
  { id: 'pet_legend', name: 'PET LEGEND', emoji: 'ğŸŒŸ', desc: 'Evolve pet to Champion' },
  { id: 'on_fire', name: 'ON FIRE', emoji: 'ğŸ”¥', desc: '3 day streak' },
  { id: 'unstoppable', name: 'UNSTOPPABLE', emoji: 'ğŸ”¥', desc: '7 day streak' },
  { id: 'speed_demon', name: 'SPEED DEMON', emoji: 'ğŸï¸', desc: '50+ clicks in Click Battle' },
  { id: 'rising_star', name: 'RISING STAR', emoji: 'â­', desc: 'Reach level 5' },
  { id: 'challenger', name: 'CHALLENGER', emoji: 'ğŸ¯', desc: 'Complete daily challenge' },
  { id: 'quest_hero', name: 'QUEST HERO', emoji: 'âš”ï¸', desc: 'Complete a quest' },
  { id: 'zen_master', name: 'ZEN MASTER', emoji: 'ğŸ§˜', desc: 'Use focus timer 5 times' },
  { id: 'bubble_pop', name: 'BUBBLE MANIA', emoji: 'ğŸ«§', desc: 'Pop 100 bubbles' },
  { id: 'math_wiz', name: 'MATH WIZ', emoji: 'ğŸ§®', desc: 'Score 10 in Math Blaster' },
  { id: 'word_smith', name: 'WORD SMITH', emoji: 'ğŸ“', desc: 'Solve 5 word scrambles' },
  { id: 'routine_star', name: 'ROUTINE STAR', emoji: 'ğŸ“‹', desc: 'Complete daily routine' },
  { id: 'upgrader', name: 'UPGRADER', emoji: 'â¬†ï¸', desc: 'Buy your first upgrade' },
  { id: 'task_master', name: 'TASK MASTER', emoji: 'âœ…', desc: 'Complete all daily tasks' }
];

// ---- GAMES CONFIG ----
const GAMES = [
  { id: 'brainrot', name: 'BRAINROT DEFENSE', emoji: 'ğŸª½âš”ï¸', desc: 'Ohio vs. Skibidi Ultimate! YOUR epic tower defense with Easy Mode! Tap, shout, and destroy!', badge: 'HAYES\'s GAME!', badgeClass: 'badge-fav', energy: 10 },
  { id: 'frycatch', name: 'FRY CATCHER', emoji: 'ğŸŸğŸ§º', desc: 'Catch falling french fries! Move your basket and collect as many golden fries as possible!', badge: 'HOT', badgeClass: 'badge-hot', energy: 8 },
  { id: 'build', name: 'BUILD BATTLE', emoji: 'ğŸ—ï¸ğŸ¯', desc: 'Fortnite-inspired building! Stack blocks, build walls, and reach the sky before time runs out!', badge: 'NEW', badgeClass: 'badge-new', energy: 10 },
  { id: 'obby', name: 'OBBY RUNNER', emoji: 'ğŸƒğŸ’¨', desc: 'Roblox-style obstacle course! Jump over blocks, dodge hazards, and race to the finish line!', badge: 'NEW', badgeClass: 'badge-new', energy: 10 },
  { id: 'factory', name: 'FRY FACTORY', emoji: 'ğŸ­ğŸŸ', desc: 'Run your own fry empire! Click to cook fries, buy upgrades, and become a fry tycoon!', badge: 'HOT', badgeClass: 'badge-hot', energy: 5 },
  { id: 'click', name: 'CLICK BATTLE', emoji: 'ğŸ‘†ğŸ’¥', desc: 'How fast can you click? Tap the target as many times as you can in 10 seconds!', badge: '', badgeClass: '', energy: 5 },
  { id: 'emoji', name: 'EMOJI MATCH', emoji: 'ğŸƒğŸ§ ', desc: 'Find matching pairs! Flip the cards and use your memory to match all the emojis!', badge: '', badgeClass: '', energy: 8 },
  { id: 'color', name: 'COLOR SMASH', emoji: 'ğŸ¨ğŸ’¥', desc: 'Tap the color that matches the word - but watch out, the colors try to trick you!', badge: 'FUN!', badgeClass: 'badge-fun', energy: 5 },
  { id: 'word', name: 'WORD SCRAMBLE', emoji: 'ğŸ”¤ğŸ§©', desc: 'Unscramble the letters to find the hidden word! Train your brain and earn fries!', badge: 'NEW!', badgeClass: 'badge-new', energy: 5 },
  { id: 'math', name: 'MATH BLASTER', emoji: 'ğŸ§®ğŸš€', desc: 'Solve math problems to blast through space! How many can you get right?', badge: 'BRAIN!', badgeClass: 'badge-fun', energy: 5 },
  { id: 'rocket', name: 'ROCKET LAUNCH', emoji: 'ğŸš€â­', desc: 'Launch your rocket and dodge asteroids! How far can you fly through space?', badge: 'NEW!', badgeClass: 'badge-new', energy: 10 },
  { id: 'dino', name: 'DINO DASH', emoji: 'ğŸ¦–ğŸŒµ', desc: 'Run as a dinosaur! Jump over cacti and dodge obstacles in this endless runner!', badge: 'FUN!', badgeClass: 'badge-fun', energy: 8 }
];

// ---- POWER-UPS CONFIG ----
const POWERUPS = [
  { id: 'motivation', name: 'MOTIVATION BOOST', emoji: 'ğŸ’ª', desc: 'Need a pick-me-up? Tap for instant awesome energy, Hayes!' },
  { id: 'joke', name: 'JOKE TIME', emoji: 'ğŸ˜‚', desc: 'Tap for a random joke! Warning: extreme laughter incoming!' },
  { id: 'spin', name: 'SPIN THE WHEEL', emoji: 'ğŸ¡', desc: 'Spin to win a challenge or reward! What will Hayes get?' },
  { id: 'fryfact', name: 'FRY FACTS', emoji: 'ğŸŸ', desc: 'Learn awesome facts about the BEST food ever - FRENCH FRIES!' },
  { id: 'wyr', name: 'WOULD YOU RATHER', emoji: 'ğŸ¤”', desc: 'Fun questions to think about! Pick your answer and earn fries!' },
  { id: 'trivia', name: 'TRIVIA BLAST', emoji: 'ğŸ§ ', desc: 'Test your knowledge about Roblox, Fortnite, fries, and more!' },
  { id: 'dance', name: 'DANCE PARTY', emoji: 'ğŸ•º', desc: 'Random dance move challenge! Can you do the move?' },
  { id: 'compliment', name: 'COMPLIMENT CANNON', emoji: 'ğŸ‰', desc: 'Fire a compliment! Share something nice with yourself!' }
];

// ---- UPGRADES CONFIG ----
const UPGRADES = [
  { id: 'fry_magnet', name: 'FRY MAGNET', emoji: 'ğŸ§²', desc: 'Earn 2x fries from all activities!', maxLvl: 5, baseCost: 50 },
  { id: 'xp_booster', name: 'XP BOOSTER', emoji: 'âš¡', desc: 'Gain 2x XP from games and actions!', maxLvl: 5, baseCost: 75 },
  { id: 'pet_charm', name: 'PET CHARM', emoji: 'ğŸ’', desc: 'Your pet loses happiness 50% slower!', maxLvl: 3, baseCost: 60 },
  { id: 'lucky_spinner', name: 'LUCKY SPINNER', emoji: 'ğŸ€', desc: 'Better rewards from Spin the Wheel!', maxLvl: 3, baseCost: 80 },
  { id: 'game_shield', name: 'GAME SHIELD', emoji: 'ğŸ›¡ï¸', desc: 'Extra lives in Fry Catcher and Obby Runner!', maxLvl: 3, baseCost: 100 },
  { id: 'streak_guard', name: 'STREAK GUARD', emoji: 'ğŸ”¥', desc: 'Protect your streak if you miss a day!', maxLvl: 1, baseCost: 200 },
  { id: 'mega_factory', name: 'MEGA FACTORY', emoji: 'ğŸ­', desc: 'Factory produces 3x more fries!', maxLvl: 3, baseCost: 120 },
  { id: 'zen_master', name: 'ZEN MASTER', emoji: 'ğŸ§˜', desc: 'Unlock extra calm sounds and themes!', maxLvl: 2, baseCost: 90 },
  { id: 'energy_tank', name: 'ENERGY TANK', emoji: 'ğŸ”‹', desc: 'Increase max energy by 25!', maxLvl: 4, baseCost: 60 },
  { id: 'quest_compass', name: 'QUEST COMPASS', emoji: 'ğŸ§­', desc: 'Quests give 2x fry rewards!', maxLvl: 3, baseCost: 100 }
];

// ---- QUESTS ----
const QUESTS = [
  { id: 'fry_collector', name: 'The Great Fry Hunt', desc: 'Collect fries across your adventure!', steps: ['Collect 20 fries', 'Collect 50 fries', 'Collect 100 fries'], rewards: [10, 25, 50], check: () => gameData.fries },
  { id: 'game_master', name: 'Game Master Journey', desc: 'Play lots of different games!', steps: ['Play 3 games', 'Play 8 games', 'Play 15 games', 'Play 30 games'], rewards: [15, 30, 50, 100], check: () => gameData.gamesPlayed },
  { id: 'pet_adventure', name: 'Pet Best Friend', desc: 'Take amazing care of your pet!', steps: ['Feed pet 5 times', 'Get pet to level 3', 'Get pet to level 5'], rewards: [20, 40, 80], check: (step) => step === 0 ? (gameData.pet.fed >= 50 ? 5 : Math.floor(gameData.pet.fed / 10)) : gameData.pet.level },
  { id: 'zen_warrior', name: 'Zen Warrior Path', desc: 'Master the art of focus!', steps: ['Use focus timer once', 'Use focus timer 3 times', 'Use focus timer 5 times'], rewards: [15, 30, 60], check: () => gameData.focusTotal },
  { id: 'badge_hunter', name: 'Badge Hunter', desc: 'Unlock achievements!', steps: ['Earn 3 badges', 'Earn 8 badges', 'Earn 15 badges'], rewards: [20, 50, 100], check: () => Object.values(gameData.achievements).filter(Boolean).length }
];

// ---- ROUTINE ----
const DAILY_ROUTINE = [
  { id: 'wake', text: 'Wake up & stretch', emoji: 'ğŸŒ', fries: 5 },
  { id: 'brush_am', text: 'Brush teeth (morning)', emoji: 'ğŸ©¸', fries: 5 },
  { id: 'breakfast', text: 'Eat breakfast', emoji: 'ğŸ³', fries: 5 },
  { id: 'dressed', text: 'Get dressed', emoji: 'ğŸ‘•', fries: 3 },
  { id: 'school', text: 'Do school work / learning', emoji: 'ğŸ“š', fries: 15 },
  { id: 'play', text: 'Outdoor play time', emoji: 'âš½', fries: 10 },
  { id: 'read', text: 'Read for 15 minutes', emoji: 'ğŸ“–', fries: 10 },
  { id: 'chores', text: 'Help with a chore', emoji: 'ğŸ§¹', fries: 10 },
  { id: 'brush_pm', text: 'Brush teeth (night)', emoji: 'ğŸ©¸', fries: 5 },
  { id: 'bed', text: 'Get ready for bed', emoji: 'ğŸ˜´', fries: 5 }
];

// ---- TASKS (reward system) ----
const DAILY_TASKS = [
  { id: 'kind', text: 'Do something kind for someone', emoji: 'ğŸ’›', fries: 10 },
  { id: 'clean', text: 'Clean your room', emoji: 'ğŸ§¹', fries: 15 },
  { id: 'hw', text: 'Finish homework', emoji: 'ğŸ“', fries: 20 },
  { id: 'listen', text: 'Listen to Dad the first time', emoji: 'ğŸ‘‚', fries: 10 },
  { id: 'water', text: 'Drink 4 glasses of water', emoji: 'ğŸ’§', fries: 5 },
  { id: 'veggies', text: 'Eat your veggies', emoji: 'ğŸ¥¦', fries: 8 },
  { id: 'share', text: 'Share with someone', emoji: 'ğŸ¤', fries: 10 },
  { id: 'patience', text: 'Practice patience today', emoji: 'ğŸ§˜', fries: 15 }
];

// ---- INIT ----
function initAll() {
  loadData();
  updateStreak();
  updateUI();
  initStars();
  initFryRain();
  initAchievements();
  initDailyChallenge();
  renderGames();
  renderPowerUps();
  initPet();
  initBreathing();
  initDailyQuote();
  initFidgetBay();
  initAwesomeWall();
  initCapsuleState();
  initUpgradeShop();
  initRoutine();
  initTasks();
  initQuests();
  initEnergySystem();
  dadWelcomeToast();
  checkAchievement('first_visit', true);
  saveData();
}

// ---- STREAK ----
function updateStreak() {
  const today = new Date().toDateString();
  if (gameData.lastVisit !== today) {
    const yesterday = new Date(Date.now() - 86400000).toDateString();
    if (gameData.lastVisit === yesterday) {
      gameData.streak++;
    } else if (gameData.lastVisit && gameData.lastVisit !== today) {
      if (!getUpgLevel('streak_guard')) gameData.streak = 1;
    }
    gameData.lastVisit = today;
    // Reset daily stuff
    gameData.challengeDone = false;
    gameData.challengeProgress = 0;
    gameData.challengeGames = [];
    gameData.routineDone = {};
    gameData.tasksDone = {};
    saveData();
  }
}

// ---- XP & FRIES ----
function addXP(amount) {
  const mult = 1 + (getUpgLevel('xp_booster') * 0.5);
  gameData.xp += Math.floor(amount * mult);
  const needed = gameData.level * 100 + 50;
  while (gameData.xp >= needed) {
    gameData.xp -= needed;
    gameData.level++;
    showToast('ğŸŒŸ LEVEL UP! You are now Level ' + gameData.level + '!');
    spawnConfetti();
    addFries(gameData.level * 5);
    if (gameData.level >= 5) checkAchievement('rising_star', true);
  }
  updateUI();
  saveData();
}
function addFries(amount) {
  const mult = 1 + (getUpgLevel('fry_magnet') * 0.5);
  gameData.fries += Math.floor(amount * mult);
  gameData.stars += Math.floor(amount / 5);
  updateUI();
  saveData();
  if (gameData.fries >= 50) checkAchievement('fry_fan', true);
  if (gameData.fries >= 500) checkAchievement('fry_lord', true);
  if (gameData.fries >= 2000) checkAchievement('fry_king', true);
}
function spendFries(amount) {
  if (gameData.fries >= amount) { gameData.fries -= amount; updateUI(); saveData(); return true; }
  showToast('ğŸŸ Not enough fries!');
  return false;
}

// ---- ENERGY SYSTEM ----
function initEnergySystem() {
  // Recharge energy over time (1% per minute)
  setInterval(() => {
    if (gameData.energy < gameData.maxEnergy) {
      gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + 1);
      updateEnergyUI();
      saveData();
    }
  }, 60000);
  updateEnergyUI();
}
function useEnergy(amount) {
  if (gameData.energy >= amount) {
    gameData.energy -= amount;
    updateEnergyUI();
    saveData();
    return true;
  }
  showToast('âš¡ Low energy! Visit the Chill Zone to recharge!');
  return false;
}
function restoreEnergy(amount) {
  gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + amount);
  updateEnergyUI();
  saveData();
}
function updateEnergyUI() {
  const pct = Math.floor((gameData.energy / gameData.maxEnergy) * 100);
  const fill = document.getElementById('energy-fill');
  const label = document.getElementById('energy-label');
  const pill = document.getElementById('energy-count');
  if (fill) fill.style.width = pct + '%';
  if (label) label.textContent = pct + '%';
  if (pill) pill.textContent = pct;
  // Change color based on energy
  if (fill) {
    if (pct > 60) fill.style.background = 'linear-gradient(90deg,var(--green),var(--lime))';
    else if (pct > 30) fill.style.background = 'linear-gradient(90deg,var(--amber),var(--orange))';
    else fill.style.background = 'linear-gradient(90deg,var(--red),var(--orange))';
  }
}

// ---- UPDATE UI ----
function updateUI() {
  const el = (id) => document.getElementById(id);
  el('stat-fries').textContent = gameData.fries;
  el('stat-games').textContent = gameData.gamesPlayed;
  el('stat-badges').textContent = Object.values(gameData.achievements).filter(Boolean).length;
  el('stat-stars').textContent = gameData.stars;
  el('stat-quests').textContent = gameData.questsComplete;
  el('fry-count').textContent = gameData.fries;
  el('level-badge').textContent = 'LVL ' + gameData.level;
  el('streak-count').textContent = gameData.streak;
  if (gameData.streak >= 3) checkAchievement('on_fire', true);
  if (gameData.streak >= 7) checkAchievement('unstoppable', true);
  const needed = gameData.level * 100 + 50;
  const pct = Math.min(100, (gameData.xp / needed) * 100);
  el('xp-bar').style.width = pct + '%';
  el('xp-text').textContent = gameData.xp + ' / ' + needed + ' XP';
  el('avatar-display').textContent = gameData.avatar;
}

// ---- MOOD ----
function setMood(mood) {
  gameData.mood = mood;
  document.getElementById('mood-msg').textContent = MOOD_MSGS[mood] || '';
  document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
  event.target.closest('.mood-btn').classList.add('selected');
  checkAchievement('mood_check', true);
  addXP(3);
  if (mood === 'sad' || mood === 'angry' || mood === 'tired') {
    setTimeout(() => showToast('ğŸ’™ Try the Chill Zone for some calm vibes!'), 1500);
  }
  if (mood === 'hyper') {
    restoreEnergy(15);
    showToast('âš¡ Hyper mode! +15 Energy!');
  }
  saveData();
}

// ---- TOAST ----
let toastTimeout;
function showToast(msg) {
  clearTimeout(toastTimeout);
  let t = document.querySelector('.toast');
  if (t) t.remove();
  t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  document.body.appendChild(t);
  toastTimeout = setTimeout(() => t.remove(), 3000);
}

// ---- CONFETTI ----
function spawnConfetti() {
  const colors = ['#FFD700','#FF6EC7','#00F0FF','#39FF14','#FF9100','#B388FF','#FF5252'];
  for (let i = 0; i < 40; i++) {
    const c = document.createElement('div');
    c.className = 'confetti-piece';
    c.style.left = Math.random() * 100 + 'vw';
    c.style.top = '-10px';
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    c.style.width = (6 + Math.random() * 8) + 'px';
    c.style.height = (6 + Math.random() * 8) + 'px';
    c.style.animationDuration = (1.5 + Math.random()) + 's';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 2500);
  }
}

// ---- FRY COLLECT ----
function collectFry() {
  addFries(1);
  addXP(1);
  showToast('ğŸŸ +1 Fry!');
}

// ---- STARS BACKGROUND ----
function initStars() {
  const c = document.getElementById('stars');
  for (let i = 0; i < 80; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    s.style.left = Math.random() * 100 + '%';
    s.style.top = Math.random() * 100 + '%';
    s.style.animationDelay = Math.random() * 3 + 's';
    s.style.animationDuration = (2 + Math.random() * 3) + 's';
    c.appendChild(s);
  }
}

// ---- FRY RAIN ----
function initFryRain() {
  setInterval(() => {
    const f = document.createElement('div');
    f.className = 'fry-rain';
    f.style.left = Math.random() * 100 + '%';
    f.style.animationDuration = (4 + Math.random() * 4) + 's';
    f.textContent = ['ğŸŸ','ğŸ’™','âš¡','ğŸ','â­','ğŸ®'][Math.floor(Math.random() * 6)];
    f.style.fontSize = (14 + Math.random() * 12) + 'px';
    document.getElementById('header').appendChild(f);
    setTimeout(() => f.remove(), 8000);
  }, 2000);
}

// ---- SCROLL ----
function scrollToSection(id) {
  document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
}

// ---- AVATAR PICKER ----
function openAvatarPicker() {
  const avatars = ['ğŸ®','ğŸ‘¾','ğŸ¤–','ğŸš€','ğŸ¦–','ğŸ‰','ğŸ¦„','ğŸ±','ğŸ¶','ğŸ»','ğŸ¦Š','ğŸ¦','ğŸ¦…','ğŸ‘»','ğŸ¦¸','ğŸ¦¹','ğŸ„','âš½','ğŸ€','ğŸ®'];
  let html = '<h3 style="font-family:Bangers;color:var(--cyan);margin-bottom:10px">Choose Your Avatar</h3><div class="avatar-grid">';
  avatars.forEach(a => {
    html += '<div class="avatar-option" onclick="pickAvatar(\'' + a + '\')">' + a + '</div>';
  });
  html += '</div>';
  showPopup(html);
}
function pickAvatar(a) { gameData.avatar = a; updateUI(); closePopup(); saveData(); showToast('ğŸŒŸ New avatar!'); }

// ---- PET SYSTEM ----
function initPet() { updatePetUI(); }
function getPetStage() {
  const lvl = gameData.pet.level;
  if (lvl >= 20) return 'Legend';
  if (lvl >= 12) return 'Champion';
  if (lvl >= 7) return 'Teen';
  if (lvl >= 3) return 'Kid';
  return 'Baby';
}
function updatePetUI() {
  document.getElementById('pet-display').textContent = gameData.pet.type;
  document.getElementById('pet-happy').textContent = Math.max(0, Math.min(100, gameData.pet.happy));
  document.getElementById('pet-fed').textContent = Math.max(0, Math.min(100, gameData.pet.fed));
  document.getElementById('pet-level').textContent = gameData.pet.level;
  document.getElementById('pet-name').textContent = gameData.pet.name || 'Buddy';
  const stage = getPetStage();
  document.getElementById('pet-stage').textContent = stage;
  document.getElementById('pet-evolution').textContent = 'Stage: ' + stage + ' | Feed & play to evolve! Baby â†’ Kid â†’ Teen â†’ Champion â†’ Legend';
  if (stage === 'Champion' || stage === 'Legend') checkAchievement('pet_legend', true);
}
function petPat() {
  gameData.pet.happy = Math.min(100, gameData.pet.happy + 3);
  document.getElementById('pet-display').classList.add('happy');
  setTimeout(() => document.getElementById('pet-display').classList.remove('happy'), 500);
  const msgs = ['Woof! ğŸ’–', gameData.pet.name + ' loves you!', 'So happy! â¤ï¸', 'Best friend! ğŸŒŸ', gameData.pet.name + ' does a happy dance!'];
  document.getElementById('pet-msg').textContent = msgs[Math.floor(Math.random() * msgs.length)];
  updatePetUI();
  saveData();
}
function petFeed() {
  if (!spendFries(5)) return;
  gameData.pet.fed = Math.min(100, gameData.pet.fed + 20);
  gameData.pet.happy = Math.min(100, gameData.pet.happy + 5);
  gameData.pet.xp += 5;
  checkPetLevelUp();
  updatePetUI();
  showToast('ğŸŸ ' + gameData.pet.name + ' loved those fries!');
  document.getElementById('pet-msg').textContent = 'Yummy fries! ' + gameData.pet.name + ' is happy! ğŸŸ';
  if (gameData.pet.fed >= 50) checkAchievement('pet_lover', true);
  saveData();
}
function petPlay() {
  gameData.pet.happy = Math.min(100, gameData.pet.happy + 15);
  gameData.pet.fed = Math.max(0, gameData.pet.fed - 5);
  gameData.pet.xp += 3;
  checkPetLevelUp();
  updatePetUI();
  const acts = [' played fetch!', ' did zoomies!', ' played hide and seek!', ' chased its tail!', ' did a backflip!'];
  document.getElementById('pet-msg').textContent = gameData.pet.name + acts[Math.floor(Math.random() * acts.length)];
  saveData();
}
function petTrick() {
  gameData.pet.tricks++;
  gameData.pet.xp += 5;
  gameData.pet.happy = Math.min(100, gameData.pet.happy + 10);
  checkPetLevelUp();
  updatePetUI();
  const tricks = [' did a spin!', ' did a high-five!', ' played dead!', ' balanced a treat!', ' rolled over!', ' shook hands!', ' jumped through a hoop!'];
  const trick = tricks[Math.floor(Math.random() * tricks.length)];
  document.getElementById('pet-msg').textContent = gameData.pet.name + trick + ' â­';
  addXP(2);
  saveData();
}
function checkPetLevelUp() {
  const needed = gameData.pet.level * 15;
  while (gameData.pet.xp >= needed) {
    gameData.pet.xp -= needed;
    gameData.pet.level++;
    showToast('ğŸŒŸ ' + gameData.pet.name + ' grew to Level ' + gameData.pet.level + '!');
    spawnConfetti();
    if (gameData.pet.level >= 5) checkAchievement('pet_master', true);
  }
}
function openPetPicker() {
  const pets = ['ğŸ¶','ğŸ±','ğŸ°','ğŸ¹','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¦Š','ğŸ¦','ğŸ¦„','ğŸ‰','ğŸ¦–','ğŸ¢','ğŸ™','ğŸ¬','ğŸ¦…','ğŸ¦œ','ğŸ§','ğŸ¦','ğŸ'];
  let html = '<h3 style="font-family:Bangers;color:var(--pink);margin-bottom:10px">Choose Your Pet</h3>';
  html += '<input type="text" id="pet-name-input" placeholder="Name your pet..." value="' + (gameData.pet.name || '') + '" style="background:var(--blue3);border:2px solid var(--blue4);border-radius:8px;padding:8px 12px;color:#fff;font-family:Fredoka;width:200px;margin-bottom:10px;outline:none" />';
  html += '<div class="avatar-grid">';
  pets.forEach(p => {
    html += '<div class="avatar-option" onclick="pickPet(\'' + p + '\')">' + p + '</div>';
  });
  html += '</div>';
  showPopup(html);
}
function pickPet(p) {
  const nameInput = document.getElementById('pet-name-input');
  if (nameInput && nameInput.value.trim()) gameData.pet.name = nameInput.value.trim();
  gameData.pet.type = p;
  updatePetUI();
  closePopup();
  saveData();
  showToast('ğŸ¾ New pet: ' + gameData.pet.name + '!');
}

// ---- ACHIEVEMENTS ----
function initAchievements() { renderAchievements(); }
function checkAchievement(id, unlock) {
  if (unlock && !gameData.achievements[id]) {
    gameData.achievements[id] = true;
    const ach = ACHIEVEMENTS.find(a => a.id === id);
    if (ach) {
      showToast('ğŸ† Badge Unlocked: ' + ach.name + '!');
      spawnConfetti();
      addFries(10);
    }
    renderAchievements();
    saveData();
  }
}
function renderAchievements() {
  const w = document.getElementById('ach-wrap');
  w.innerHTML = '';
  ACHIEVEMENTS.forEach(a => {
    const unlocked = gameData.achievements[a.id];
    const d = document.createElement('div');
    d.className = 'ach-item' + (unlocked ? '' : ' locked');
    d.innerHTML = '<div class="ach-icon">' + (unlocked ? a.emoji : 'ğŸ”’') + '</div><div class="ach-label">' + a.name + '</div>';
    d.title = a.desc;
    w.appendChild(d);
  });
}

// ---- DAILY CHALLENGE ----
const CHALLENGES = [
  { text: 'Play 2 different games!', target: 2, type: 'games' },
  { text: 'Earn 30 fries today!', target: 30, type: 'fries' },
  { text: 'Feed your pet 3 times!', target: 3, type: 'petfeed' },
  { text: 'Complete 3 routine items!', target: 3, type: 'routine' },
  { text: 'Pop 15 bubbles!', target: 15, type: 'bubbles' },
  { text: 'Play a game and check your mood!', target: 2, type: 'actions' }
];
let currentChallenge;
function initDailyChallenge() {
  const idx = new Date().getDay() % CHALLENGES.length;
  currentChallenge = CHALLENGES[idx];
  document.getElementById('challenge-text').textContent = currentChallenge.text;
  updateChallengeUI();
}
function updateChallengeUI() {
  const pct = Math.min(100, (gameData.challengeProgress / currentChallenge.target) * 100);
  document.getElementById('challenge-fill').style.width = pct + '%';
  document.getElementById('challenge-btn').style.display = gameData.challengeDone ? 'none' : 'inline-block';
}
function completeChallenge() {
  if (gameData.challengeProgress >= currentChallenge.target && !gameData.challengeDone) {
    gameData.challengeDone = true;
    addFries(25);
    addXP(20);
    checkAchievement('challenger', true);
    showToast('ğŸ¯ Daily Challenge Complete! +25 fries!');
    spawnConfetti();
    updateChallengeUI();
    saveData();
  } else if (!gameData.challengeDone) {
    showToast('ğŸ¯ Keep going! ' + gameData.challengeProgress + '/' + currentChallenge.target);
  }
}
function bumpChallenge(type) {
  if (gameData.challengeDone) return;
  if (currentChallenge.type === type || currentChallenge.type === 'actions') {
    gameData.challengeProgress++;
    updateChallengeUI();
    saveData();
  }
}

// ---- RENDER GAMES ----
function renderGames() {
  const grid = document.getElementById('game-grid');
  grid.innerHTML = '';
  GAMES.forEach(g => {
    const d = document.createElement('div');
    d.className = 'game-card';
    d.onclick = () => openGame(g.id);
    d.innerHTML = '<div class="game-card-emoji">' + g.emoji + '</div><div class="game-card-title">' + g.name + '</div><div class="game-card-desc">' + g.desc + '</div>' + (g.badge ? '<span class="card-badge ' + g.badgeClass + '">' + g.badge + '</span>' : '') + '<div style="margin-top:8px;font-family:Silkscreen;font-size:10px;color:var(--blue5)">âš¡ ' + g.energy + ' Energy</div>';
    grid.appendChild(d);
  });
}

// ---- RENDER POWER-UPS ----
function renderPowerUps() {
  const grid = document.getElementById('power-grid');
  grid.innerHTML = '';
  POWERUPS.forEach(p => {
    const d = document.createElement('div');
    d.className = 'power-card';
    d.onclick = () => activatePower(p.id);
    d.innerHTML = '<div class="power-emoji">' + p.emoji + '</div><div class="power-title">' + p.name + '</div><div class="power-desc">' + p.desc + '</div>';
    grid.appendChild(d);
  });
}

// ---- GAME SYSTEM ----
function openGame(id) {
  const game = GAMES.find(g => g.id === id);
  if (!game) return;
  if (!useEnergy(game.energy)) return;
  gameData.gamesPlayed++;
  if (!gameData.challengeGames) gameData.challengeGames = [];
  if (!gameData.challengeGames.includes(id)) gameData.challengeGames.push(id);
  bumpChallenge('games');
  checkAchievement('gamer', true);
  if (gameData.gamesPlayed >= 10) checkAchievement('pro_gamer', true);
  if (gameData.gamesPlayed >= 50) checkAchievement('mega_gamer', true);
  addXP(5);
  saveData();
  updateUI();

  const overlay = document.getElementById('game-overlay');
  document.getElementById('game-overlay-title').textContent = game.name;
  const body = document.getElementById('game-body');
  overlay.classList.add('active');

  switch(id) {
    case 'brainrot': startBrainrot(body); break;
    case 'frycatch': startFryCatch(body); break;
    case 'build': startBuildBattle(body); break;
    case 'obby': startObbyRunner(body); break;
    case 'factory': startFryFactory(body); break;
    case 'click': startClickBattle(body); break;
    case 'emoji': startEmojiMatch(body); break;
    case 'color': startColorSmash(body); break;
    case 'word': startWordScramble(body); break;
    case 'math': startMathBlaster(body); break;
    case 'rocket': startRocketLaunch(body); break;
    case 'dino': startDinoDash(body); break;
  }
}
function closeGame() {
  document.getElementById('game-overlay').classList.remove('active');
  document.getElementById('game-body').innerHTML = '';
  // Clear any game intervals
  if (window._gameInterval) { clearInterval(window._gameInterval); window._gameInterval = null; }
  if (window._gameAnim) { cancelAnimationFrame(window._gameAnim); window._gameAnim = null; }
  if (window._gameTimeout) { clearTimeout(window._gameTimeout); window._gameTimeout = null; }
}

// ---- BRAINROT DEFENSE ----
function startBrainrot(body) {
  body.innerHTML = '<div style="text-align:center;padding:20px"><p style="font-family:Bangers;font-size:24px;color:var(--cyan)">BRAINROT DEFENSE</p><p style="color:var(--blue6);margin:10px 0">Ohio vs Skibidi! Tap enemies to destroy them!</p><div id="br-field" style="position:relative;width:100%;height:300px;background:var(--blue1);border:2px solid var(--blue4);border-radius:12px;overflow:hidden;cursor:crosshair"></div><p style="margin-top:10px;font-family:Silkscreen;font-size:13px">Score: <span id="br-score">0</span> | Lives: <span id="br-lives">5</span></p></div>';
  let score = 0, lives = 5 + getUpgLevel('game_shield');
  const field = document.getElementById('br-field');
  const enemies = ['ğŸ’©','ğŸ§Ÿ','ğŸ‘¾','ğŸ’€','ğŸ‘»','ğŸ« '];
  function spawnEnemy() {
    if (lives <= 0) return;
    const e = document.createElement('div');
    e.style.cssText = 'position:absolute;font-size:32px;cursor:pointer;transition:0.1s;user-select:none';
    e.style.left = Math.random() * 85 + '%';
    e.style.top = '-40px';
    e.textContent = enemies[Math.floor(Math.random() * enemies.length)];
    e.onclick = () => {
      score++;
      document.getElementById('br-score').textContent = score;
      e.style.transform = 'scale(1.5)';
      e.textContent = 'ğŸ’¥';
      setTimeout(() => e.remove(), 200);
      addFries(1);
    };
    field.appendChild(e);
    let y = -40;
    const speed = 1 + Math.min(score / 20, 3);
    const moveInterval = setInterval(() => {
      y += speed;
      e.style.top = y + 'px';
      if (y > 300) {
        clearInterval(moveInterval);
        e.remove();
        lives--;
        document.getElementById('br-lives').textContent = lives;
        if (lives <= 0) endBrainrot(score);
      }
    }, 30);
  }
  function endBrainrot(s) {
    clearInterval(window._gameInterval);
    addFries(Math.floor(s / 2));
    addXP(s);
    field.innerHTML = '<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center"><p style="font-family:Bangers;font-size:28px;color:var(--gold)">GAME OVER!</p><p style="font-size:18px">Score: ' + s + '</p><p style="color:var(--green)">+' + Math.floor(s/2) + ' fries!</p></div>';
  }
  window._gameInterval = setInterval(spawnEnemy, 1200 - Math.min(score * 10, 600));
}

// ---- FRY CATCHER ----
function startFryCatch(body) {
  body.innerHTML = '<div style="text-align:center"><canvas id="fc-canvas" width="400" height="350" style="background:var(--blue1);border-radius:12px;display:block;margin:0 auto;max-width:100%"></canvas><p style="font-family:Silkscreen;font-size:12px;margin-top:8px">Score: <span id="fc-score">0</span> | Time: <span id="fc-time">30</span>s</p><p style="font-size:11px;color:var(--blue5)">â†â†’ Arrow keys or tap sides to move</p></div>';
  const canvas = document.getElementById('fc-canvas');
  const ctx = canvas.getContext('2d');
  let basketX = 170, score = 0, timeLeft = 30;
  let fries = [];
  const timer = setInterval(() => {
    timeLeft--;
    document.getElementById('fc-time').textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      clearInterval(window._gameInterval);
      addFries(score);
      addXP(score * 2);
      showToast('ğŸŸ Caught ' + score + ' fries!');
    }
  }, 1000);
  window._gameInterval = setInterval(() => {
    fries.push({ x: Math.random() * 360, y: 0, speed: 2 + Math.random() * 2 });
  }, 500);
  function draw() {
    ctx.clearRect(0, 0, 400, 350);
    // Basket
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(basketX, 310, 60, 30);
    ctx.fillStyle = '#D2691E';
    ctx.fillRect(basketX + 5, 315, 50, 20);
    // Fries
    fries.forEach((f, i) => {
      f.y += f.speed;
      ctx.font = '24px serif';
      ctx.fillText('ğŸŸ', f.x, f.y);
      if (f.y > 310 && f.x > basketX - 10 && f.x < basketX + 60) {
        score++;
        document.getElementById('fc-score').textContent = score;
        fries.splice(i, 1);
      } else if (f.y > 360) {
        fries.splice(i, 1);
      }
    });
    if (timeLeft > 0) window._gameAnim = requestAnimationFrame(draw);
  }
  draw();
  const keyHandler = (e) => {
    if (e.key === 'ArrowLeft') basketX = Math.max(0, basketX - 20);
    if (e.key === 'ArrowRight') basketX = Math.min(340, basketX + 20);
  };
  document.addEventListener('keydown', keyHandler);
  canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    if (x < rect.width / 2) basketX = Math.max(0, basketX - 25);
    else basketX = Math.min(340, basketX + 25);
  });
  // Store cleanup
  const origClose = closeGame;
  window._gameCleanup = () => {
    document.removeEventListener('keydown', keyHandler);
    clearInterval(timer);
  };
}

// ---- BUILD BATTLE ----
function startBuildBattle(body) {
  body.innerHTML = '<div style="text-align:center"><canvas id="bb-canvas" width="400" height="350" style="background:var(--blue1);border-radius:12px;display:block;margin:0 auto;max-width:100%"></canvas><p style="font-family:Silkscreen;font-size:12px;margin-top:8px">Height: <span id="bb-height">0</span> | Time: <span id="bb-time">20</span>s</p><p style="font-size:11px;color:var(--blue5)">Click/Tap to place blocks!</p></div>';
  const canvas = document.getElementById('bb-canvas');
  const ctx = canvas.getContext('2d');
  let blocks = [], height = 0, timeLeft = 20, blockX = 0, dir = 1, speed = 2;
  const colors = ['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFEAA7','#DDA0DD','#98D8C8'];
  const timer = setInterval(() => {
    timeLeft--;
    document.getElementById('bb-time').textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      const reward = height * 3;
      addFries(reward);
      addXP(height * 2);
      showToast('ğŸ—ï¸ Built ' + height + ' blocks! +' + reward + ' fries!');
    }
  }, 1000);
  canvas.onclick = () => {
    if (timeLeft <= 0) return;
    blocks.push({ x: blockX, y: 350 - (height + 1) * 25, w: 60, color: colors[height % colors.length] });
    height++;
    document.getElementById('bb-height').textContent = height;
    speed = Math.min(5, 2 + height * 0.2);
  };
  function draw() {
    ctx.clearRect(0, 0, 400, 350);
    // Ground
    ctx.fillStyle = '#333';
    ctx.fillRect(0, 340, 400, 10);
    // Moving block
    blockX += dir * speed;
    if (blockX > 340 || blockX < 0) dir *= -1;
    ctx.fillStyle = colors[height % colors.length];
    ctx.fillRect(blockX, 350 - (height + 1) * 25, 60, 24);
    // Placed blocks
    blocks.forEach(b => {
      ctx.fillStyle = b.color;
      ctx.fillRect(b.x, b.y, b.w, 24);
      ctx.strokeStyle = '#000';
      ctx.strokeRect(b.x, b.y, b.w, 24);
    });
    if (timeLeft > 0) window._gameAnim = requestAnimationFrame(draw);
  }
  draw();
}

// ---- OBBY RUNNER ----
function startObbyRunner(body) {
  body.innerHTML = '<div style="text-align:center"><canvas id="ob-canvas" width="400" height="250" style="background:linear-gradient(to bottom,#1a1a3e,#0a0a2e);border-radius:12px;display:block;margin:0 auto;max-width:100%"></canvas><p style="font-family:Silkscreen;font-size:12px;margin-top:8px">Distance: <span id="ob-dist">0</span>m</p><p style="font-size:11px;color:var(--blue5)">Space/Tap to jump!</p></div>';
  const canvas = document.getElementById('ob-canvas');
  const ctx = canvas.getContext('2d');
  let playerY = 190, velY = 0, jumping = false, dist = 0, alive = true, obstacles = [], speed = 3;
  function jump() { if (!jumping && alive) { velY = -10; jumping = true; } }
  document.addEventListener('keydown', function obbyKey(e) {
    if (e.code === 'Space') { e.preventDefault(); jump(); }
    window._obbyKey = obbyKey;
  });
  canvas.addEventListener('click', jump);
  function draw() {
    if (!alive) return;
    ctx.clearRect(0, 0, 400, 250);
    // Ground
    ctx.fillStyle = '#39FF14';
    ctx.fillRect(0, 220, 400, 30);
    // Player
    velY += 0.6;
    playerY += velY;
    if (playerY >= 190) { playerY = 190; jumping = false; velY = 0; }
    ctx.font = '28px serif';
    ctx.fillText('ğŸƒ', 50, playerY + 20);
    // Obstacles
    if (Math.random() < 0.02 + dist / 5000) {
      obstacles.push({ x: 410, h: 20 + Math.random() * 20 });
    }
    obstacles.forEach((o, i) => {
      o.x -= speed;
      ctx.fillStyle = '#FF5252';
      ctx.fillRect(o.x, 220 - o.h, 20, o.h);
      if (o.x < 75 && o.x > 40 && playerY + 20 > 220 - o.h) {
        alive = false;
        const reward = Math.floor(dist / 10);
        addFries(reward);
        addXP(Math.floor(dist / 5));
        showToast('ğŸƒ Ran ' + dist + 'm! +' + reward + ' fries!');
      }
      if (o.x < -20) obstacles.splice(i, 1);
    });
    dist++;
    speed = 3 + dist / 500;
    document.getElementById('ob-dist').textContent = dist;
    if (alive) window._gameAnim = requestAnimationFrame(draw);
  }
  draw();
}

// ---- FRY FACTORY ----
function startFryFactory(body) {
  let fryCount = 0, fpm = 0, upgrades = { grill: 0, fryer: 0, robot: 0 };
  const mult = 1 + getUpgLevel('mega_factory');
  body.innerHTML = '<div id="ff-ui" style="text-align:center;padding:15px"><p style="font-family:Bangers;font-size:28px;color:var(--gold)">ğŸŸ FRY FACTORY ğŸŸ</p><div style="font-size:64px;cursor:pointer;margin:15px 0" onclick="window._ffClick()">ğŸŸ</div><p style="font-family:Silkscreen;font-size:16px" id="ff-count">0 fries cooked</p><p style="font-family:Silkscreen;font-size:12px;color:var(--blue5)" id="ff-fpm">0 fries/min</p><div style="margin-top:15px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap"><button onclick="window._ffUpg(\'grill\')" style="background:var(--blue3);border:2px solid var(--orange);border-radius:10px;padding:8px 14px;color:#fff;font-family:Silkscreen;font-size:11px;cursor:pointer">ğŸ”¥ Grill (x<span id="ff-grill">0</span>) - 10 fries</button><button onclick="window._ffUpg(\'fryer\')" style="background:var(--blue3);border:2px solid var(--orange);border-radius:10px;padding:8px 14px;color:#fff;font-family:Silkscreen;font-size:11px;cursor:pointer">ğŸ³ Fryer (x<span id="ff-fryer">0</span>) - 25 fries</button><button onclick="window._ffUpg(\'robot\')" style="background:var(--blue3);border:2px solid var(--orange);border-radius:10px;padding:8px 14px;color:#fff;font-family:Silkscreen;font-size:11px;cursor:pointer">ğŸ¤– Robot (x<span id="ff-robot">0</span>) - 50 fries</button></div><button onclick="window._ffCash()" style="margin-top:15px;background:var(--gold);border:none;color:#000;padding:10px 20px;border-radius:10px;font-family:Silkscreen;cursor:pointer">ğŸ’° CASH OUT</button></div>';
  window._ffClick = () => {
    fryCount += mult;
    document.getElementById('ff-count').textContent = Math.floor(fryCount) + ' fries cooked';
  };
  window._ffUpg = (type) => {
    const costs = { grill: 10, fryer: 25, robot: 50 };
    if (fryCount >= costs[type]) {
      fryCount -= costs[type];
      upgrades[type]++;
      document.getElementById('ff-' + type).textContent = upgrades[type];
      fpm = (upgrades.grill * 2 + upgrades.fryer * 5 + upgrades.robot * 12) * mult;
      document.getElementById('ff-fpm').textContent = fpm + ' fries/min';
      document.getElementById('ff-count').textContent = Math.floor(fryCount) + ' fries cooked';
    }
  };
  window._ffCash = () => {
    const earned = Math.floor(fryCount);
    if (earned > 0) {
      addFries(earned);
      showToast('ğŸŸ Cashed out ' + earned + ' fries!');
      fryCount = 0;
      document.getElementById('ff-count').textContent = '0 fries cooked';
    }
  };
  window._gameInterval = setInterval(() => {
    fryCount += fpm / 60;
    document.getElementById('ff-count').textContent = Math.floor(fryCount) + ' fries cooked';
  }, 1000);
}

// ---- CLICK BATTLE ----
function startClickBattle(body) {
  body.innerHTML = '<div style="text-align:center;padding:20px"><p style="font-family:Bangers;font-size:24px;color:var(--cyan)">CLICK BATTLE!</p><p style="color:var(--blue6)">Click as fast as you can in 10 seconds!</p><div id="cb-target" style="width:100px;height:100px;border-radius:50%;background:var(--red);margin:20px auto;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:32px;transition:0.1s">ğŸ’¥</div><p style="font-family:Silkscreen;font-size:20px">Clicks: <span id="cb-count">0</span></p><p style="font-family:Silkscreen;font-size:14px">Time: <span id="cb-time">10</span>s</p><p style="font-family:Silkscreen;font-size:12px;color:var(--gold)">Best: <span id="cb-best">' + (gameData.clickBest || 0) + '</span></p></div>';
  let clicks = 0, started = false, timeLeft = 10;
  const target = document.getElementById('cb-target');
  target.onclick = () => {
    if (!started) {
      started = true;
      window._gameInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('cb-time').textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(window._gameInterval);
          target.style.pointerEvents = 'none';
          if (clicks > gameData.clickBest) { gameData.clickBest = clicks; saveData(); }
          addFries(Math.floor(clicks / 3));
          addXP(clicks);
          if (clicks >= 50) checkAchievement('speed_demon', true);
          showToast('ğŸ’¥ ' + clicks + ' clicks! +' + Math.floor(clicks / 3) + ' fries!');
        }
      }, 1000);
    }
    clicks++;
    document.getElementById('cb-count').textContent = clicks;
    target.style.transform = 'scale(0.9)';
    setTimeout(() => target.style.transform = 'scale(1)', 50);
  };
}

// ---- EMOJI MATCH ----
function startEmojiMatch(body) {
  const emojis = ['ğŸŸ','ğŸš€','âš¡','ğŸ®','ğŸŒŸ','ğŸ”¥','ğŸ’–','ğŸ†'];
  let deck = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
  let flipped = [], matched = 0, moves = 0;
  body.innerHTML = '<div style="text-align:center;padding:10px"><p style="font-family:Bangers;font-size:20px;color:var(--cyan)">EMOJI MATCH</p><p style="font-family:Silkscreen;font-size:12px">Matches: <span id="em-matches">0</span>/8 | Moves: <span id="em-moves">0</span></p><div id="em-grid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;max-width:320px;margin:10px auto"></div></div>';
  const grid = document.getElementById('em-grid');
  deck.forEach((emoji, i) => {
    const card = document.createElement('div');
    card.style.cssText = 'width:70px;height:70px;background:var(--blue3);border:2px solid var(--blue4);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;transition:0.3s;margin:0 auto';
    card.textContent = '?';
    card.dataset.idx = i;
    card.dataset.emoji = emoji;
    card.onclick = () => flipCard(card);
    grid.appendChild(card);
  });
  function flipCard(card) {
    if (flipped.length >= 2 || card.dataset.flipped) return;
    card.textContent = card.dataset.emoji;
    card.dataset.flipped = 'true';
    card.style.borderColor = 'var(--cyan)';
    flipped.push(card);
    if (flipped.length === 2) {
      moves++;
      document.getElementById('em-moves').textContent = moves;
      if (flipped[0].dataset.emoji === flipped[1].dataset.emoji) {
        matched++;
        document.getElementById('em-matches').textContent = matched;
        flipped[0].style.borderColor = 'var(--green)';
        flipped[1].style.borderColor = 'var(--green)';
        flipped = [];
        if (matched === 8) {
          addFries(15);
          addXP(20);
          showToast('ğŸ† All matched! +15 fries!');
          spawnConfetti();
        }
      } else {
        setTimeout(() => {
          flipped.forEach(c => { c.textContent = '?'; c.dataset.flipped = ''; c.style.borderColor = 'var(--blue4)'; });
          flipped = [];
        }, 800);
      }
    }
  }
}

// ---- COLOR SMASH ----
function startColorSmash(body) {
  const colors = [{name:'RED',hex:'#FF5252'},{name:'BLUE',hex:'#2196F3'},{name:'GREEN',hex:'#39FF14'},{name:'YELLOW',hex:'#FFD700'},{name:'PURPLE',hex:'#B388FF'},{name:'ORANGE',hex:'#FF9100'}];
  let score = 0, round = 0, maxRounds = 12;
  body.innerHTML = '<div style="text-align:center;padding:20px"><p style="font-family:Bangers;font-size:24px;color:var(--cyan)">COLOR SMASH!</p><p style="font-family:Silkscreen;font-size:12px">Score: <span id="cs-score">0</span>/' + maxRounds + '</p><div id="cs-word" style="font-family:Bangers;font-size:48px;margin:20px 0">---</div><div id="cs-options" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;max-width:350px;margin:0 auto"></div></div>';
  function nextRound() {
    if (round >= maxRounds) {
      addFries(score * 2);
      addXP(score * 3);
      showToast('ğŸ¨ Score: ' + score + '/' + maxRounds + '! +' + (score*2) + ' fries!');
      return;
    }
    const wordColor = colors[Math.floor(Math.random() * colors.length)];
    const displayColor = colors[Math.floor(Math.random() * colors.length)];
    document.getElementById('cs-word').textContent = wordColor.name;
    document.getElementById('cs-word').style.color = displayColor.hex;
    const opts = document.getElementById('cs-options');
    opts.innerHTML = '';
    const shuffled = [...colors].sort(() => Math.random() - 0.5).slice(0, 3);
    if (!shuffled.find(c => c.name === displayColor.name)) shuffled[0] = displayColor;
    shuffled.sort(() => Math.random() - 0.5);
    shuffled.forEach(c => {
      const btn = document.createElement('button');
      btn.style.cssText = 'background:' + c.hex + ';border:2px solid transparent;border-radius:10px;padding:12px;color:#000;font-family:Silkscreen;font-size:13px;cursor:pointer;font-weight:700';
      btn.textContent = c.name;
      btn.onclick = () => {
        round++;
        if (c.name === displayColor.name) {
          score++;
          document.getElementById('cs-score').textContent = score;
          btn.style.borderColor = '#fff';
        }
        setTimeout(nextRound, 500);
      };
      opts.appendChild(btn);
    });
  }
  nextRound();
}

// ---- WORD SCRAMBLE ----
let wordSolveCount = 0;
function startWordScramble(body) {
  const words = ['FRIES','GAMES','SUPER','HAPPY','BRAVE','HERO','POWER','EPIC','ROCKET','PIZZA','DRAGON','NINJA','ROBOT','MAGIC','SPACE','LASER','STORM','BLAZE','TURBO','QUEST'];
  const word = words[Math.floor(Math.random() * words.length)];
  const scrambled = word.split('').sort(() => Math.random() - 0.5);
  let answer = [];
  let letterUsed = new Array(scrambled.length).fill(false);
  body.innerHTML = '<div class="word-scramble"><p style="font-family:Bangers;font-size:24px;color:var(--cyan)">WORD SCRAMBLE</p><p style="color:var(--blue6);margin:8px 0">Unscramble the letters!</p><div class="scramble-answer" id="ws-answer"></div><div class="scramble-letters" id="ws-letters"></div><p id="ws-msg" style="font-size:14px;color:var(--gold);min-height:24px"></p><button onclick="window._wsReset()" style="background:var(--blue3);border:2px solid var(--cyan);border-radius:8px;padding:6px 14px;color:#fff;font-family:Silkscreen;font-size:11px;cursor:pointer">Reset</button></div>';
  function renderSlots() {
    const slotsDiv = document.getElementById('ws-answer');
    slotsDiv.innerHTML = '';
    for (let i = 0; i < word.length; i++) {
      const slot = document.createElement('div');
      slot.className = 'scramble-slot';
      slot.textContent = answer[i] || '';
      slot.onclick = () => {
        if (answer[i]) {
          // Find which letter to un-use
          const origIdx = answer[i]._origIdx;
          if (origIdx !== undefined) letterUsed[origIdx] = false;
          answer.splice(i, 1);
          renderSlots();
          renderLetters();
        }
      };
      slotsDiv.appendChild(slot);
    }
  }
  function renderLetters() {
    const lettersDiv = document.getElementById('ws-letters');
    lettersDiv.innerHTML = '';
    scrambled.forEach((l, i) => {
      const btn = document.createElement('div');
      btn.className = 'scramble-letter' + (letterUsed[i] ? ' used' : '');
      btn.textContent = l;
      btn.onclick = () => {
        if (letterUsed[i]) return;
        letterUsed[i] = true;
        const letterObj = { toString() { return l; }, _origIdx: i };
        answer.push(letterObj);
        renderSlots();
        renderLetters();
        if (answer.length === word.length) {
          const guess = answer.map(a => a.toString()).join('');
          if (guess === word) {
            document.getElementById('ws-msg').textContent = 'âœ… CORRECT! ' + word + '!';
            document.getElementById('ws-msg').style.color = 'var(--green)';
            addFries(8);
            addXP(10);
            wordSolveCount++;
            if (wordSolveCount >= 5) checkAchievement('word_smith', true);
            spawnConfetti();
          } else {
            document.getElementById('ws-msg').textContent = 'âŒ Try again!';
            document.getElementById('ws-msg').style.color = 'var(--red)';
            setTimeout(() => {
              answer = [];
              letterUsed.fill(false);
              renderSlots();
              renderLetters();
              document.getElementById('ws-msg').textContent = '';
            }, 1000);
          }
        }
      };
      lettersDiv.appendChild(btn);
    });
  }
  window._wsReset = () => {
    answer = [];
    letterUsed.fill(false);
    document.getElementById('ws-msg').textContent = '';
    renderSlots();
    renderLetters();
  };
  renderSlots();
  renderLetters();
}

// ---- MATH BLASTER ----
function startMathBlaster(body) {
  let score = 0, round = 0, maxRounds = 15;
  body.innerHTML = '<div class="math-game"><p style="font-family:Bangers;font-size:24px;color:var(--cyan)">ğŸš€ MATH BLASTER ğŸš€</p><p style="font-family:Silkscreen;font-size:12px">Score: <span id="mb-score">0</span>/' + maxRounds + '</p><div class="math-problem" id="mb-problem">?</div><div class="math-options" id="mb-options"></div><p id="mb-msg" style="font-size:14px;min-height:24px;margin-top:10px"></p></div>';
  function nextProblem() {
    if (round >= maxRounds) {
      addFries(score * 2);
      addXP(score * 3);
      if (score >= 10) checkAchievement('math_wiz', true);
      showToast('ğŸ§® Math Blaster: ' + score + '/' + maxRounds + '! +' + (score * 2) + ' fries!');
      document.getElementById('mb-problem').textContent = 'Done! ' + score + '/' + maxRounds;
      document.getElementById('mb-options').innerHTML = '';
      return;
    }
    const ops = ['+', '-', 'Ã—'];
    const op = ops[Math.floor(Math.random() * ops.length)];
    let a, b, answer;
    if (op === '+') { a = Math.floor(Math.random() * 20) + 1; b = Math.floor(Math.random() * 20) + 1; answer = a + b; }
    else if (op === '-') { a = Math.floor(Math.random() * 20) + 5; b = Math.floor(Math.random() * a); answer = a - b; }
    else { a = Math.floor(Math.random() * 10) + 1; b = Math.floor(Math.random() * 10) + 1; answer = a * b; }
    document.getElementById('mb-problem').textContent = a + ' ' + op + ' ' + b + ' = ?';
    document.getElementById('mb-msg').textContent = '';
    const options = [answer];
    while (options.length < 4) {
      const wrong = answer + Math.floor(Math.random() * 10) - 5;
      if (wrong !== answer && !options.includes(wrong) && wrong >= 0) options.push(wrong);
    }
    options.sort(() => Math.random() - 0.5);
    const optDiv = document.getElementById('mb-options');
    optDiv.innerHTML = '';
    options.forEach(o => {
      const btn = document.createElement('div');
      btn.className = 'math-option';
      btn.textContent = o;
      btn.onclick = () => {
        round++;
        if (o === answer) {
          score++;
          document.getElementById('mb-score').textContent = score;
          btn.classList.add('correct');
          document.getElementById('mb-msg').textContent = 'âœ… Correct!';
          document.getElementById('mb-msg').style.color = 'var(--green)';
        } else {
          btn.classList.add('wrong');
          document.getElementById('mb-msg').textContent = 'âŒ Answer was ' + answer;
          document.getElementById('mb-msg').style.color = 'var(--red)';
        }
        optDiv.querySelectorAll('.math-option').forEach(b => b.style.pointerEvents = 'none');
        setTimeout(nextProblem, 1200);
      };
      optDiv.appendChild(btn);
    });
  }
  nextProblem();
}

// ---- ROCKET LAUNCH ----
function startRocketLaunch(body) {
  body.innerHTML = '<div class="rocket-game"><canvas id="rl-canvas" width="400" height="400" style="max-width:100%"></canvas><p style="font-family:Silkscreen;font-size:12px;margin-top:8px">Score: <span id="rl-score">0</span></p><p style="font-size:11px;color:var(--blue5)">â†â†’ Arrow keys or tap sides to dodge!</p></div>';
  const canvas = document.getElementById('rl-canvas');
  const ctx = canvas.getContext('2d');
  let rocketX = 185, score = 0, alive = true, asteroids = [], stars = [];
  // Init stars
  for (let i = 0; i < 30; i++) stars.push({ x: Math.random() * 400, y: Math.random() * 400, s: Math.random() * 2 });
  const keyHandler = (e) => {
    if (e.key === 'ArrowLeft') rocketX = Math.max(0, rocketX - 20);
    if (e.key === 'ArrowRight') rocketX = Math.min(370, rocketX + 20);
  };
  document.addEventListener('keydown', keyHandler);
  canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    if (x < rect.width / 2) rocketX = Math.max(0, rocketX - 25);
    else rocketX = Math.min(370, rocketX + 25);
  });
  function draw() {
    if (!alive) return;
    ctx.fillStyle = '#0a0a2e';
    ctx.fillRect(0, 0, 400, 400);
    // Stars
    stars.forEach(s => {
      s.y += s.s + 1;
      if (s.y > 400) { s.y = 0; s.x = Math.random() * 400; }
      ctx.fillStyle = '#fff';
      ctx.fillRect(s.x, s.y, 2, 2);
    });
    // Rocket
    ctx.font = '30px serif';
    ctx.fillText('ğŸš€', rocketX, 360);
    // Asteroids
    if (Math.random() < 0.03 + score / 3000) {
      asteroids.push({ x: Math.random() * 380, y: -20, speed: 2 + Math.random() * 2 + score / 200 });
    }
    asteroids.forEach((a, i) => {
      a.y += a.speed;
      ctx.font = '24px serif';
      ctx.fillText('â˜„ï¸', a.x, a.y);
      // Collision
      if (a.y > 340 && a.y < 380 && Math.abs(a.x - rocketX) < 25) {
        alive = false;
        const reward = Math.floor(score / 5);
        addFries(reward);
        addXP(score);
        showToast('ğŸš€ Flew ' + score + ' points! +' + reward + ' fries!');
        document.removeEventListener('keydown', keyHandler);
      }
      if (a.y > 420) asteroids.splice(i, 1);
    });
    score++;
    document.getElementById('rl-score').textContent = score;
    if (alive) window._gameAnim = requestAnimationFrame(draw);
  }
  draw();
}

// ---- DINO DASH ----
function startDinoDash(body) {
  body.innerHTML = '<div class="dino-game"><canvas id="dd-canvas" width="400" height="200" style="max-width:100%"></canvas><p style="font-family:Silkscreen;font-size:12px;margin-top:8px">Score: <span id="dd-score">0</span></p><p style="font-size:11px;color:var(--blue5)">Space/Tap to jump!</p></div>';
  const canvas = document.getElementById('dd-canvas');
  const ctx = canvas.getContext('2d');
  let dinoY = 140, velY = 0, jumping = false, score = 0, alive = true, cacti = [], speed = 3;
  function jump() { if (!jumping && alive) { velY = -12; jumping = true; } }
  const keyHandler = (e) => { if (e.code === 'Space') { e.preventDefault(); jump(); } };
  document.addEventListener('keydown', keyHandler);
  canvas.addEventListener('click', jump);
  function draw() {
    if (!alive) return;
    ctx.clearRect(0, 0, 400, 200);
    // Ground
    ctx.fillStyle = '#8B7355';
    ctx.fillRect(0, 170, 400, 30);
    // Dino
    velY += 0.8;
    dinoY += velY;
    if (dinoY >= 140) { dinoY = 140; jumping = false; velY = 0; }
    ctx.font = '28px serif';
    ctx.fillText('ğŸ¦–', 40, dinoY + 20);
    // Cacti
    if (Math.random() < 0.02 + score / 5000) {
      cacti.push({ x: 420, type: Math.random() > 0.5 ? 'ğŸŒµ' : 'ğŸª¨' });
    }
    cacti.forEach((c, i) => {
      c.x -= speed;
      ctx.font = '24px serif';
      ctx.fillText(c.type, c.x, 165);
      if (c.x < 65 && c.x > 30 && dinoY + 20 > 145) {
        alive = false;
        const reward = Math.floor(score / 8);
        addFries(reward);
        addXP(Math.floor(score / 4));
        showToast('ğŸ¦– Score: ' + score + '! +' + reward + ' fries!');
        document.removeEventListener('keydown', keyHandler);
      }
      if (c.x < -30) cacti.splice(i, 1);
    });
    score++;
    speed = 3 + score / 400;
    document.getElementById('dd-score').textContent = score;
    if (alive) window._gameAnim = requestAnimationFrame(draw);
  }
  draw();
}

// ---- POWER-UP ACTIONS ----
function activatePower(id) {
  switch(id) {
    case 'motivation': showMotivation(); break;
    case 'joke': showJoke(); break;
    case 'spin': spinWheel(); break;
    case 'fryfact': showFryFact(); break;
    case 'wyr': showWouldYouRather(); break;
    case 'trivia': showTrivia(); break;
    case 'dance': showDanceChallenge(); break;
    case 'compliment': showCompliment(); break;
  }
  addXP(3);
  bumpChallenge('actions');
}
function showMotivation() {
  const msgs = [
    "Hayes, you are INCREDIBLE! Nothing can stop you! ğŸ’ª",
    "You're braver than you believe, stronger than you seem! ğŸŒŸ",
    "Every champion was once a beginner. You're already amazing! ğŸ†",
    "Hayes, you light up every room you walk into! â­",
    "Your energy and creativity are SUPERPOWERS! âš¡",
    "Dad is SO proud of you. You're his hero! ğŸ¦¸",
    "You can do ANYTHING you set your mind to! ğŸš€",
    "The world is lucky to have Hayes in it! ğŸŒ",
    "You're not just special - you're ONE OF A KIND! ğŸ’"
  ];
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸ’ª</div><p style="font-family:Bangers;font-size:24px;color:var(--gold)">MOTIVATION BOOST!</p><p style="font-size:16px;margin:15px 0;line-height:1.6">' + msgs[Math.floor(Math.random() * msgs.length)] + '</p>');
  addFries(2);
}
function showJoke() {
  const jokes = [
    "Why did the french fry go to the doctor? Because it was feeling \"crispy\"! ğŸŸ",
    "What do you call a fake noodle? An impasta! ğŸ",
    "Why don't scientists trust atoms? Because they make up everything! ğŸ”¬",
    "What did the ocean say to the beach? Nothing, it just waved! ğŸŒŠ",
    "Why did the scarecrow win an award? He was outstanding in his field! ğŸŒ¾",
    "What do you call a sleeping dinosaur? A dino-snore! ğŸ¦–",
    "Why can't a nose be 12 inches long? Because then it would be a foot! ğŸ‘£",
    "What has ears but cannot hear? A cornfield! ğŸŒ½",
    "Why did the math book look sad? Because it had too many problems! ğŸ“š",
    "What do you call a bear with no teeth? A gummy bear! ğŸ»"
  ];
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸ˜‚</div><p style="font-family:Bangers;font-size:22px;color:var(--cyan)">JOKE TIME!</p><p style="font-size:16px;margin:15px 0;line-height:1.6">' + jokes[Math.floor(Math.random() * jokes.length)] + '</p>');
  addFries(2);
}
function spinWheel() {
  const prizes = [
    { text: 'ğŸŸ 10 BONUS FRIES!', fries: 10 },
    { text: 'ğŸŸ 5 BONUS FRIES!', fries: 5 },
    { text: 'âš¡ +20 XP BOOST!', fries: 0, xp: 20 },
    { text: 'ğŸ”¥ ENERGY REFILL!', fries: 0, energy: 30 },
    { text: 'ğŸŸ 20 MEGA FRIES!', fries: 20 },
    { text: 'ğŸ† +50 XP!', fries: 0, xp: 50 },
    { text: 'â­ 15 STAR FRIES!', fries: 15 },
    { text: 'ğŸ’ª TRY AGAIN!', fries: 1 }
  ];
  const lucky = getUpgLevel('lucky_spinner');
  const idx = Math.floor(Math.random() * (prizes.length - lucky));
  const prize = prizes[idx];
  showPopup('<div style="font-size:48px;margin-bottom:15px;animation:spin 1s">ğŸ¡</div><p style="font-family:Bangers;font-size:22px;color:var(--gold)">SPIN RESULT!</p><p style="font-size:18px;margin:15px 0">' + prize.text + '</p>');
  if (prize.fries) addFries(prize.fries);
  if (prize.xp) addXP(prize.xp);
  if (prize.energy) restoreEnergy(prize.energy);
  spawnConfetti();
}
function showFryFact() {
  const facts = [
    "French fries were invented in Belgium, not France! ğŸ‡§ğŸ‡ª",
    "Americans eat about 4.5 billion pounds of fries per year! ğŸ‡ºğŸ‡¸",
    "The longest french fry ever was 34 inches long! ğŸ“",
    "French fries are the most popular side dish in America! ğŸ‡ºğŸ‡¸",
    "There's a french fry museum in Bruges, Belgium! ğŸ›ï¸",
    "Fries are made from potatoes, which grow underground! ğŸ¥”",
    "Thomas Jefferson brought fries to America from France! ğŸ‡«ğŸ‡·",
    "The average American eats 30 pounds of fries per year! ğŸ½ï¸"
  ];
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸŸ</div><p style="font-family:Bangers;font-size:22px;color:var(--gold)">FRY FACT!</p><p style="font-size:16px;margin:15px 0;line-height:1.6">' + facts[Math.floor(Math.random() * facts.length)] + '</p>');
  addFries(2);
}
function showWouldYouRather() {
  const qs = [
    { a: 'Have unlimited fries forever', b: 'Be able to fly' },
    { a: 'Be a superhero', b: 'Be a wizard' },
    { a: 'Live in a video game', b: 'Live in a movie' },
    { a: 'Have a pet dragon', b: 'Have a pet unicorn' },
    { a: 'Be super fast', b: 'Be super strong' },
    { a: 'Have X-ray vision', b: 'Be invisible' },
    { a: 'Explore space', b: 'Explore the ocean' },
    { a: 'Be a ninja', b: 'Be a pirate' }
  ];
  const q = qs[Math.floor(Math.random() * qs.length)];
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸ¤”</div><p style="font-family:Bangers;font-size:22px;color:var(--cyan)">WOULD YOU RATHER?</p><div style="display:flex;gap:12px;margin:15px 0;justify-content:center;flex-wrap:wrap"><button onclick="wyrPick()" style="background:var(--blue4);border:none;color:#fff;padding:14px 20px;border-radius:12px;font-family:Fredoka;font-size:14px;cursor:pointer;flex:1;min-width:130px">' + q.a + '</button><span style="align-self:center;font-family:Bangers;color:var(--gold)">OR</span><button onclick="wyrPick()" style="background:var(--purple);border:none;color:#fff;padding:14px 20px;border-radius:12px;font-family:Fredoka;font-size:14px;cursor:pointer;flex:1;min-width:130px">' + q.b + '</button></div>');
}
function wyrPick() { addFries(3); addXP(3); closePopup(); showToast('ğŸŸ Great choice! +3 fries!'); }
function showTrivia() {
  const qs = [
    { q: 'What is the most popular game on Roblox?', opts: ['Adopt Me', 'Minecraft', 'Tetris', 'Pac-Man'], ans: 0 },
    { q: 'What game has a Battle Bus?', opts: ['Roblox', 'Minecraft', 'Fortnite', 'Mario'], ans: 2 },
    { q: 'How many sides does a hexagon have?', opts: ['5', '6', '7', '8'], ans: 1 },
    { q: 'What color do you get mixing blue and yellow?', opts: ['Purple', 'Orange', 'Green', 'Red'], ans: 2 },
    { q: 'What planet is closest to the Sun?', opts: ['Venus', 'Earth', 'Mars', 'Mercury'], ans: 3 },
    { q: 'How many legs does a spider have?', opts: ['6', '8', '10', '4'], ans: 1 }
  ];
  const t = qs[Math.floor(Math.random() * qs.length)];
  let html = '<div style="font-size:48px;margin-bottom:15px">ğŸ§ </div><p style="font-family:Bangers;font-size:22px;color:var(--cyan)">TRIVIA BLAST!</p><p style="font-size:16px;margin:15px 0">' + t.q + '</p><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;max-width:350px;margin:0 auto">';
  t.opts.forEach((o, i) => {
    html += '<button onclick="triviaAnswer(' + (i === t.ans ? 'true' : 'false') + ')" style="background:var(--blue3);border:2px solid var(--blue4);border-radius:10px;padding:10px;color:#fff;font-family:Fredoka;cursor:pointer">' + o + '</button>';
  });
  html += '</div>';
  showPopup(html);
}
function triviaAnswer(correct) {
  if (correct) { addFries(5); addXP(8); closePopup(); showToast('âœ… Correct! +5 fries!'); spawnConfetti(); }
  else { closePopup(); showToast('âŒ Not quite! Try again next time!'); addFries(1); }
}
function showDanceChallenge() {
  const moves = [
    'ğŸ•º Do the ROBOT for 10 seconds!',
    'ğŸ’ƒ Spin around 3 times!',
    'ğŸ•º Do 5 jumping jacks!',
    'ğŸ’ƒ Floss dance for 10 seconds!',
    'ğŸ•º Do the worm (or try to)!',
    'ğŸ’ƒ Moonwalk across the room!',
    'ğŸ•º Dance like a chicken!',
    'ğŸ’ƒ Do your best superhero pose!'
  ];
  const move = moves[Math.floor(Math.random() * moves.length)];
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸ•º</div><p style="font-family:Bangers;font-size:22px;color:var(--pink)">DANCE CHALLENGE!</p><p style="font-size:18px;margin:15px 0">' + move + '</p><button onclick="addFries(5);addXP(5);closePopup();showToast(\'\u{1F57A} Epic moves! +5 fries!\')" style="background:var(--pink);border:none;color:#fff;padding:10px 20px;border-radius:10px;font-family:Bangers;font-size:16px;cursor:pointer;margin-top:10px">I DID IT! ğŸ”¥</button>');
}
function showCompliment() {
  const compliments = [
    "Hayes, your smile could power a whole city! ğŸŒ",
    "You have the heart of a champion! ğŸ’–",
    "Your creativity is LEGENDARY! ğŸ¨",
    "You make everyone around you happier! ğŸ˜Š",
    "Your brain is more powerful than any supercomputer! ğŸ§ ",
    "You're the kind of person who makes the world AWESOME! ğŸŒ",
    "Your laugh is the best sound in the universe! ğŸ˜‚",
    "You have more courage than you know! ğŸ¦¸"
  ];
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸ‰</div><p style="font-family:Bangers;font-size:22px;color:var(--gold)">COMPLIMENT CANNON!</p><p style="font-size:18px;margin:15px 0;line-height:1.6">' + compliments[Math.floor(Math.random() * compliments.length)] + '</p>');
  spawnConfetti();
  addFries(2);
}

// ---- POPUP SYSTEM ----
function showPopup(html) {
  document.getElementById('popup-content').innerHTML = html;
  document.getElementById('popup-overlay').classList.add('active');
}
function closePopup() {
  document.getElementById('popup-overlay').classList.remove('active');
}

// ---- BREATHING EXERCISE ----
function initBreathing() {
  const circle = document.getElementById('breath-circle');
  let breathIn = true;
  setInterval(() => {
    breathIn = !breathIn;
    circle.textContent = breathIn ? 'Breathe in...' : 'Breathe out...';
    circle.classList.toggle('expand', breathIn);
  }, 4000);
}

// ---- DAILY QUOTE ----
function initDailyQuote() {
  const quotes = [
    { text: "Hayes, you make the world better just by being in it!", source: "Fact" },
    { text: "Your brain works in amazing ways. That's your superpower!", source: "Dad" },
    { text: "It's okay to take breaks. Even superheroes recharge!", source: "Truth" },
    { text: "You don't have to be perfect. You just have to be YOU!", source: "Wisdom" },
    { text: "Every expert was once a beginner. Keep going, Hayes!", source: "Fact" },
    { text: "Your energy is a gift. Use it to do amazing things!", source: "Dad" },
    { text: "Mistakes help your brain grow. They're secretly awesome!", source: "Science" },
    { text: "Hayes, your kindness makes the world a better place!", source: "Truth" }
  ];
  const q = quotes[new Date().getDay() % quotes.length];
  document.getElementById('quote-text').textContent = '"' + q.text + '"';
  document.getElementById('quote-source').textContent = q.source;
}

// ---- CALM AUDIO ----
let calmAudio = null;
function playSound(type) {
  stopCalm();
  // Use simple oscillator-based ambient sounds
  try {
    const ac = new (window.AudioContext || window.webkitAudioContext)();
    calmAudio = ac;
    if (type === 'rain') {
      const bufferSize = 2 * ac.sampleRate;
      const noiseBuffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;
      const noise = ac.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;
      const filter = ac.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.value = 400;
      const gain = ac.createGain();
      gain.gain.value = 0.15;
      noise.connect(filter);
      filter.connect(gain);
      gain.connect(ac.destination);
      noise.start();
    } else {
      // Simple tone for other sounds
      const osc = ac.createOscillator();
      const gain = ac.createGain();
      osc.type = type === 'ocean' ? 'sine' : type === 'forest' ? 'triangle' : 'sawtooth';
      osc.frequency.value = type === 'ocean' ? 80 : type === 'forest' ? 220 : 60;
      gain.gain.value = 0.05;
      osc.connect(gain);
      gain.connect(ac.destination);
      osc.start();
      // Modulate for ambient effect
      const lfo = ac.createOscillator();
      lfo.frequency.value = type === 'ocean' ? 0.1 : 0.3;
      const lfoGain = ac.createGain();
      lfoGain.gain.value = type === 'ocean' ? 30 : 50;
      lfo.connect(lfoGain);
      lfoGain.connect(osc.frequency);
      lfo.start();
    }
    restoreEnergy(10);
    showToast('ğŸµ Calm sounds playing... +10 Energy!');
    document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
  } catch(e) {
    showToast('ğŸµ Imagine calm ' + type + ' sounds...');
  }
}
function stopCalm() {
  if (calmAudio) { try { calmAudio.close(); } catch(e){} calmAudio = null; }
  document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('active'));
}
function playRain() { playSound('rain'); }
function playOcean() { playSound('ocean'); }
function playForest() { playSound('forest'); }
function playSpace() { playSound('space'); }

// ---- FOCUS TIMER ----
let focusInterval = null, focusSeconds = 900, focusMax = 900, focusRunning = false;
function toggleFocusTimer() {
  if (focusRunning) {
    clearInterval(focusInterval);
    focusRunning = false;
    showToast('â¸ï¸ Timer paused');
  } else {
    focusRunning = true;
    focusInterval = setInterval(focusTick, 1000);
    showToast('â–¶ï¸ Focus mode activated!');
  }
}
function focusTick() {
  focusSeconds--;
  updateFocusUI();
  if (focusSeconds <= 0) {
    clearInterval(focusInterval);
    focusRunning = false;
    gameData.focusTotal = (gameData.focusTotal || 0) + 1;
    addFries(15);
    addXP(25);
    restoreEnergy(20);
    spawnConfetti();
    showToast('â³ Focus complete! +15 fries! +20 energy!');
    if (gameData.focusTotal >= 5) checkAchievement('zen_master', true);
    bumpChallenge('actions');
    focusSeconds = focusMax;
    updateFocusUI();
    saveData();
  }
}
function updateFocusUI() {
  const m = Math.floor(focusSeconds / 60);
  const s = focusSeconds % 60;
  document.getElementById('focus-time').textContent = m + ':' + (s < 10 ? '0' : '') + s;
  const pct = (focusSeconds / focusMax) * 100;
  document.getElementById('focus-fill').style.width = pct + '%';
}
function resetFocusTimer() {
  clearInterval(focusInterval);
  focusRunning = false;
  focusSeconds = focusMax;
  updateFocusUI();
}
function setFocusTime(mins) {
  clearInterval(focusInterval);
  focusRunning = false;
  focusMax = mins * 60;
  focusSeconds = focusMax;
  updateFocusUI();
}

// ---- FIDGET BAY ----
function initFidgetBay() {
  const grid = document.getElementById('bubble-grid');
  grid.innerHTML = '';
  for (let i = 0; i < 18; i++) {
    const b = document.createElement('div');
    b.className = 'bubble';
    b.onclick = () => popBubble(b);
    grid.appendChild(b);
  }
}
function popBubble(b) {
  if (b.classList.contains('popped')) return;
  b.classList.add('popped');
  b.textContent = 'ğŸ’¨';
  gameData.totalPops = (gameData.totalPops || 0) + 1;
  document.getElementById('pop-count').textContent = gameData.totalPops;
  bumpChallenge('bubbles');
  if (gameData.totalPops >= 100) checkAchievement('bubble_pop', true);
  saveData();
  // Check if all popped, then reset
  const bubbles = document.querySelectorAll('.bubble');
  const allPopped = [...bubbles].every(b => b.classList.contains('popped'));
  if (allPopped) {
    addFries(3);
    showToast('ğŸ«§ All popped! +3 fries! Resetting...');
    setTimeout(initFidgetBay, 1000);
  }
}

// ---- DAD LOVE FEATURES ----
function revealSecret() {
  const secrets = [
    "Dad thinks about you ALL DAY at work! ğŸ’™",
    "You are the BEST thing that ever happened to Dad! ğŸ’–",
    "Dad's favorite sound is your laugh! ğŸ˜‚",
    "You make Dad proud EVERY SINGLE DAY! ğŸ†",
    "Dad's superpower is loving YOU! âš¡",
    "No matter what, Dad will ALWAYS be here for you! ğŸ ",
    "You are Dad's greatest adventure! ğŸš€",
    "Dad loved you before you were even born! ğŸ’™"
  ];
  const msg = secrets[Math.floor(Math.random() * secrets.length)];
  document.getElementById('secret-box').innerHTML = '<p style="font-size:16px;color:var(--gold)">' + msg + '</p>';
  addFries(3);
  spawnConfetti();
}
function openCapsule() {
  const surprises = [
    { emoji: 'ğŸŸ', text: '10 BONUS FRIES!', fries: 10 },
    { emoji: 'â­', text: 'SUPER STAR POWER!', fries: 5 },
    { emoji: 'ğŸš€', text: 'ROCKET BOOST! +30 XP!', fries: 0, xp: 30 },
    { emoji: 'ğŸ’–', text: 'DAD LOVE POWER-UP!', fries: 8 },
    { emoji: 'âš¡', text: 'ENERGY SURGE! +25 Energy!', fries: 0, energy: 25 },
    { emoji: 'ğŸ®', text: 'GAME MASTER BONUS!', fries: 15 },
    { emoji: 'ğŸ¦¸', text: 'HERO CAPE ACTIVATED!', fries: 12 }
  ];
  const s = surprises[Math.floor(Math.random() * surprises.length)];
  showPopup('<div style="font-size:64px;animation:bounce 0.5s">' + s.emoji + '</div><p style="font-family:Bangers;font-size:24px;color:var(--gold);margin:15px 0">' + s.text + '</p>');
  if (s.fries) addFries(s.fries);
  if (s.xp) addXP(s.xp);
  if (s.energy) restoreEnergy(s.energy);
  spawnConfetti();
}
function showLoveLetter() {
  showPopup('<div style="font-size:48px;margin-bottom:15px">ğŸ’Œ</div><h3 style="font-family:Bangers;font-size:24px;color:var(--pink)">Dear Hayes,</h3><p style="font-size:15px;line-height:1.8;margin:15px 0;text-align:left">You are the most amazing kid in the whole universe. Every day with you is an adventure, and Dad wouldn\'t trade it for anything.</p><p style="font-size:15px;line-height:1.8;margin:15px 0;text-align:left">Your energy, your creativity, your big heart â€” these are all SUPERPOWERS. Never let anyone tell you different.</p><p style="font-size:15px;line-height:1.8;margin:15px 0;text-align:left">When things feel hard, remember: Dad believes in you MORE than anyone. You are brave, you are strong, and you are loved beyond measure.</p><p style="font-size:15px;line-height:1.8;margin:15px 0;text-align:left">I love you to the moon, past all the stars, and back again. Forever and always.</p><p style="font-family:Bangers;font-size:20px;color:var(--pink);margin-top:15px">Love, Dad ğŸ’™â¤ï¸ğŸ’™</p>');
  spawnHearts();
}
function spawnHearts() {
  for (let i = 0; i < 20; i++) {
    const h = document.createElement('div');
    h.style.cssText = 'position:fixed;font-size:' + (16 + Math.random() * 20) + 'px;z-index:999;pointer-events:none;animation:confettiFall ' + (2 + Math.random()) + 's forwards';
    h.style.left = Math.random() * 100 + 'vw';
    h.style.top = '-20px';
    h.textContent = ['ğŸ’™','ğŸ’–','â¤ï¸','ğŸ’œ','ğŸ’“'][Math.floor(Math.random() * 5)];
    document.body.appendChild(h);
    setTimeout(() => h.remove(), 3000);
  }
}
function initAwesomeWall() {
  const wall = document.getElementById('awesome-wall');
  const tags = ['Super Creative','Kind Heart','Brave Hero','Amazing Gamer','Fast Learner','Great Friend','Funny Guy','Smart Cookie','Hard Worker','Never Gives Up','Fry Expert','Cool Kid','Awesome Builder','Quick Thinker','Big Dreamer','True Champion','Joy Bringer','Problem Solver','Adventure Seeker','Star Player','Music Lover','Roblox Pro','Fortnite Legend','Dance Master',"Dad's Pride",'Energy King','Laughter Master'];
  tags.forEach(t => {
    const span = document.createElement('span');
    span.className = 'awesome-tag';
    span.textContent = t;
    wall.appendChild(span);
  });
}
function initCapsuleState() {}

// ---- AFFIRMATIONS ----
function newAffirmation() {
  const affs = [
    "It is okay to take a break. Even heroes rest! ğŸ¦¸",
    "Your brain is unique and POWERFUL! ğŸ§ ",
    "You don't need to sit still to be smart! âš¡",
    "Having lots of energy is a SUPERPOWER! ğŸ’ª",
    "It's okay if today is hard. Tomorrow is a new chance! ğŸŒŸ",
    "You are loved exactly the way you are! ğŸ’™",
    "Your ideas are worth sharing! ğŸ’¡",
    "Deep breaths help your brain work better! ğŸŒ€",
    "Being different is what makes you AMAZING! â­",
    "You can do hard things! One step at a time! ğŸš€",
    "Fidgeting helps your brain focus. That's science! ğŸ”¬",
    "Every big achievement starts with a tiny step! ğŸ‘£"
  ];
  document.getElementById('transmission-text').textContent = affs[Math.floor(Math.random() * affs.length)];
}

// ---- DAD WELCOME ----
function dadWelcomeToast() {
  const hour = new Date().getHours();
  let greeting;
  if (hour < 12) greeting = 'Good morning';
  else if (hour < 17) greeting = 'Good afternoon';
  else greeting = 'Good evening';
  document.getElementById('dad-greeting').textContent = greeting + ', Hayes! Dad loves you!';
  setTimeout(() => showToast('ğŸ’™ ' + greeting + ', Hayes! Ready for adventure?'), 1000);
}

// ---- PROTOCOL ZERO (fullscreen calm) ----
function startProtocolZero() {
  document.getElementById('protocol-zero').classList.add('active');
  restoreEnergy(20);
}
function stopProtocolZero() {
  document.getElementById('protocol-zero').classList.remove('active');
}

// ---- UPGRADE SHOP ----
function initUpgradeShop() { renderUpgradeShop(); }
function getUpgLevel(id) { return gameData.upgrades[id] || 0; }
function getUpgCost(upg) {
  const lvl = getUpgLevel(upg.id);
  return Math.floor(upg.baseCost * Math.pow(1.5, lvl));
}
function renderUpgradeShop() {
  const grid = document.getElementById('upgrade-grid');
  grid.innerHTML = '';
  UPGRADES.forEach(u => {
    const lvl = getUpgLevel(u.id);
    const cost = getUpgCost(u);
    const maxed = lvl >= u.maxLvl;
    const d = document.createElement('div');
    d.className = 'upgrade-card';
    d.style.position = 'relative';
    d.innerHTML = '<span style="position:absolute;top:8px;right:8px;font-family:Silkscreen;font-size:10px;background:var(--purple);color:#fff;padding:2px 8px;border-radius:6px">LVL ' + lvl + '/' + u.maxLvl + '</span><div class="upgrade-emoji">' + u.emoji + '</div><div class="upgrade-name">' + u.name + '</div><div class="upgrade-desc">' + u.desc + '</div><div class="upgrade-bar"><div class="upgrade-fill" style="width:' + (lvl / u.maxLvl * 100) + '%"></div></div><div class="upgrade-cost">ğŸŸ ' + (maxed ? 'MAXED' : cost + ' FRIES') + '</div>' + (maxed ? '' : '<button class="upgrade-btn" onclick="buyUpgrade(\'' + u.id + '\')">' + 'UPGRADE â¬†ï¸</button>');
    grid.appendChild(d);
  });
}
function buyUpgrade(id) {
  const upg = UPGRADES.find(u => u.id === id);
  if (!upg) return;
  const lvl = getUpgLevel(id);
  if (lvl >= upg.maxLvl) { showToast('â¬†ï¸ Already maxed!'); return; }
  const cost = getUpgCost(upg);
  if (spendFries(cost)) {
    gameData.upgrades[id] = lvl + 1;
    // Apply energy tank immediately
    if (id === 'energy_tank') {
      gameData.maxEnergy += 25;
      gameData.energy = Math.min(gameData.energy + 25, gameData.maxEnergy);
      updateEnergyUI();
    }
    showToast('â¬†ï¸ ' + upg.name + ' upgraded to Level ' + (lvl + 1) + '!');
    checkAchievement('upgrader', true);
    spawnConfetti();
    renderUpgradeShop();
    saveData();
  }
}

// ---- ROUTINE ----
function initRoutine() {
  const list = document.getElementById('routine-list');
  list.innerHTML = '';
  DAILY_ROUTINE.forEach(r => {
    const done = gameData.routineDone[r.id];
    const d = document.createElement('div');
    d.className = 'routine-item' + (done ? ' done' : '');
    d.innerHTML = '<div class="routine-check">' + (done ? 'âœ…' : '') + '</div><span style="font-size:18px">' + r.emoji + '</span><span class="routine-text">' + r.text + '</span><span class="routine-reward">ğŸŸ +' + r.fries + '</span>';
    d.onclick = () => toggleRoutine(r);
    list.appendChild(d);
  });
  updateRoutineProgress();
}
function toggleRoutine(r) {
  if (gameData.routineDone[r.id]) return; // Can't undo
  gameData.routineDone[r.id] = true;
  addFries(r.fries);
  addXP(5);
  bumpChallenge('routine');
  showToast('âœ… ' + r.text + ' done! +' + r.fries + ' fries!');
  const allDone = DAILY_ROUTINE.every(item => gameData.routineDone[item.id]);
  if (allDone) {
    checkAchievement('routine_star', true);
    addFries(20);
    showToast('ğŸŒŸ ALL ROUTINE COMPLETE! +20 bonus fries!');
    spawnConfetti();
  }
  saveData();
  initRoutine();
}
function updateRoutineProgress() {
  const done = DAILY_ROUTINE.filter(r => gameData.routineDone[r.id]).length;
  document.getElementById('routine-progress').textContent = done + '/' + DAILY_ROUTINE.length + ' Done';
}

// ---- TASK REWARD SYSTEM ----
function initTasks() {
  const list = document.getElementById('task-list');
  list.innerHTML = '';
  DAILY_TASKS.forEach(t => {
    const done = gameData.tasksDone[t.id];
    const d = document.createElement('div');
    d.className = 'task-item' + (done ? ' done' : '');
    d.innerHTML = '<div class="task-check">' + (done ? 'âœ…' : '') + '</div><span style="font-size:18px">' + t.emoji + '</span><span class="task-text">' + t.text + '</span><span class="task-fries">ğŸŸ +' + t.fries + '</span>';
    d.onclick = () => completeTask(t);
    list.appendChild(d);
  });
  updateTaskProgress();
}
function completeTask(t) {
  if (gameData.tasksDone[t.id]) return;
  gameData.tasksDone[t.id] = true;
  addFries(t.fries);
  addXP(8);
  showToast('â­ Task done! +' + t.fries + ' fries!');
  const allDone = DAILY_TASKS.every(item => gameData.tasksDone[item.id]);
  if (allDone) {
    checkAchievement('task_master', true);
    addFries(30);
    showToast('ğŸŒŸ ALL TASKS COMPLETE! +30 bonus fries!');
    spawnConfetti();
  }
  saveData();
  initTasks();
}
function updateTaskProgress() {
  const done = DAILY_TASKS.filter(t => gameData.tasksDone[t.id]).length;
  document.getElementById('task-progress').textContent = done + '/' + DAILY_TASKS.length + ' Tasks Done';
}

// ---- QUEST SYSTEM ----
function initQuests() {
  const container = document.getElementById('quest-container');
  container.innerHTML = '';
  QUESTS.forEach(q => {
    const progress = gameData.questProgress[q.id] || 0;
    const currentStep = Math.min(progress, q.steps.length - 1);
    const completed = progress >= q.steps.length;
    const d = document.createElement('div');
    d.className = 'quest-card';
    d.style.borderColor = completed ? 'var(--green)' : 'var(--red)';
    let stepsHtml = '<div class="quest-progress">';
    q.steps.forEach((s, i) => {
      const complete = i < progress;
      const current = i === progress;
      stepsHtml += '<div class="quest-step ' + (complete ? 'complete' : '') + (current ? ' current' : '') + '">' + (i + 1) + '</div>';
    });
    stepsHtml += '</div>';
    d.innerHTML = '<div class="quest-title">' + (completed ? 'âœ… ' : 'âš”ï¸ ') + q.name + '</div><div class="quest-desc">' + q.desc + '</div>' + stepsHtml + '<p style="font-size:12px;color:var(--blue6);margin-top:8px">' + (completed ? 'QUEST COMPLETE!' : 'Current: ' + q.steps[Math.min(progress, q.steps.length - 1)]) + '</p>' + (!completed ? '<button onclick="checkQuestProgress(\'' + q.id + '\')" style="background:var(--red);border:none;color:#fff;padding:6px 14px;border-radius:8px;font-family:Silkscreen;font-size:11px;cursor:pointer;margin-top:8px">CHECK PROGRESS</button>' : '');
    container.appendChild(d);
  });
}
function checkQuestProgress(questId) {
  const quest = QUESTS.find(q => q.id === questId);
  if (!quest) return;
  const currentStep = gameData.questProgress[questId] || 0;
  if (currentStep >= quest.steps.length) {
    showToast('âœ… Quest already complete!');
    return;
  }
  const value = quest.check(currentStep);
  const thresholds = { fry_collector: [20, 50, 100], game_master: [3, 8, 15, 30], pet_adventure: [5, 3, 5], zen_warrior: [1, 3, 5], badge_hunter: [3, 8, 15] };
  const threshold = thresholds[questId] ? thresholds[questId][currentStep] : 0;
  if (value >= threshold) {
    gameData.questProgress[questId] = currentStep + 1;
    const reward = quest.rewards[currentStep];
    const qMult = 1 + getUpgLevel('quest_compass');
    addFries(Math.floor(reward * qMult));
    addXP(reward);
    showToast('âš”ï¸ Quest step complete! +' + Math.floor(reward * qMult) + ' fries!');
    spawnConfetti();
    if (currentStep + 1 >= quest.steps.length) {
      gameData.questsComplete++;
      checkAchievement('quest_hero', true);
      showToast('ğŸ† QUEST COMPLETE: ' + quest.name + '!');
    }
    saveData();
    initQuests();
    updateUI();
  } else {
    showToast('ğŸ“Š Progress: ' + value + '/' + threshold + ' - Keep going!');
  }
}

// ---- INIT ON LOAD ----
document.addEventListener('DOMContentLoaded', initAll);

// ---- PET DECAY (slow) ----
setInterval(() => {
  const decay = getUpgLevel('pet_charm') ? 0.5 : 1;
  gameData.pet.happy = Math.max(0, gameData.pet.happy - decay);
  gameData.pet.fed = Math.max(0, gameData.pet.fed - decay);
  updatePetUI();
  saveData();
}, 120000);
</script>
</body>
</html>
